import{a as z}from"./chunk-DCALQDKE.js";import{a as ee,b as te,c as ie,d as ne}from"./chunk-2CYVADF6.js";import"./chunk-ULFGH5XU.js";import{a as re}from"./chunk-Y6SZKX5H.js";import"./chunk-4WY6IZPL.js";import{d as X,e as Y}from"./chunk-WDDFHKIH.js";import"./chunk-AGVKSH7H.js";import{p as H}from"./chunk-V2NMUT4R.js";import{a as oe}from"./chunk-2O7EOZOI.js";import{a as Q,c as Z}from"./chunk-KEBJO4LJ.js";import{d as K,e as W}from"./chunk-PEYIU4ER.js";import"./chunk-RJZ3H7D5.js";import"./chunk-5YI4S6VK.js";import{f as J}from"./chunk-PXM2JOVS.js";import{C as U,x as w}from"./chunk-27E65EIB.js";import{b as $,e as G}from"./chunk-67M3DXMG.js";import{h as N,n as B}from"./chunk-FYJ5Y7AH.js";import{$a as L,Ab as h,Gb as I,Hb as P,Ib as O,Jb as D,Kb as l,Lb as u,Mb as A,Qa as a,Rb as V,Sb as j,Ub as b,Y as f,ba as F,f as T,fb as v,hb as _,ka as x,la as C,lb as g,mb as E,mc as k,qb as n,rb as o,sb as c,wb as y,z as M,zb as S}from"./chunk-PSXZOWGB.js";import{a as q,b as R}from"./chunk-PSFXZ2QL.js";var ae=["dt"],se=r=>["/dashboard/menu/motor-requests/comments",r],le=r=>["/dashboard/menu/motor-requests/edit",r],ce=r=>["/dashboard/menu/motor-requests/view-motor-request",r];function pe(r,m){r&1&&c(0,"app-loading-data-banner")}function de(r,m){if(r&1&&(n(0,"div",32),c(1,"i",33),n(2,"span"),l(3),o()()),r&2){let e=m.$implicit;a(),g(e.icon+" "+e.color),a(),g(e.color),a(),u(e.label)}}function ue(r,m){if(r&1&&(n(0,"div",32),c(1,"i",33),n(2,"span"),l(3),o()()),r&2){let e=m.$implicit;a(),g(e.icon+" "+e.color),a(),g(e.color),a(),u(e.label)}}function me(r,m){if(r&1){let e=y();n(0,"tr",13)(1,"th",14),l(2,"ID "),c(3,"p-sortIcon",15),o(),n(4,"th",16),l(5,"Name "),c(6,"p-sortIcon",17),o(),n(7,"th",18),l(8,"Phone "),c(9,"p-sortIcon",19),o(),n(10,"th",20),l(11,"Car Type "),c(12,"p-sortIcon",21),o(),n(13,"th",22),l(14,"Car Brand "),c(15,"p-sortIcon",23),o(),n(16,"th",24),l(17,"Car Model "),c(18,"p-sortIcon",25),o(),n(19,"th",13)(20,"p-dropdown",26,1),S("onChange",function(i){x(e);let s=D(21);return h(2).onRequestTypeFilterChange(i.value),C(s.showClear=!0)}),o()(),n(22,"th",27),l(23,"Created "),c(24,"p-sortIcon",28),o(),n(25,"th",13),l(26,"Comments"),o(),n(27,"th",13)(28,"p-dropdown",29),S("onChange",function(i){x(e);let s=h(2);return C(s.onFilterChange(i.value))}),v(29,de,4,5,"ng-template",30)(30,ue,4,5,"ng-template",31),o()(),n(31,"th",13),l(32,"View"),o()()}if(r&2){let e=h(2);a(20),_("options",e.requestTypeOptions)("showClear",!0)("autoZIndex",!0),a(8),_("options",e.selectOptions)("showClear",!0)("autoZIndex",!0)}}function he(r,m){if(r&1&&(n(0,"tr",13)(1,"td"),l(2),o(),n(3,"td"),l(4),o(),n(5,"td"),l(6),o(),n(7,"td"),l(8),o(),n(9,"td"),l(10),o(),n(11,"td"),l(12),o(),n(13,"td"),l(14),o(),n(15,"td"),l(16),o(),n(17,"td",13)(18,"a",34),c(19,"i",35),o()(),n(20,"td",36)(21,"div",37),c(22,"i",33),n(23,"span"),l(24),o()()(),n(25,"td")(26,"div",38)(27,"a",34),c(28,"i",39),o(),n(29,"a",34),c(30,"i",40),o()()()()),r&2){let e=m.$implicit,t=h(2);a(2),u(e.id),a(2),u(e.name),a(2),u(e.phone),a(2),u(e.car_type),a(2),u(e.car_brand),a(2),u(e.car_model),a(2),u(e.request_type||"individual"),a(2),u(t.formatDate(e.created_at)),a(2),_("routerLink",b(17,se,e.id)),a(2),_("ngClass",t.getStatusClass(e.active_status)),a(2),g(t.getStatusIcon(e.active_status)+" "+t.getStatusColor(e.active_status)),a(),g(t.getStatusColor(e.active_status)),a(),A(" ",t.getStatusLabel(e.active_status)," "),a(3),_("routerLink",b(19,le,e.id)),a(2),_("routerLink",b(21,ce,e.id))}}function _e(r,m){r&1&&(n(0,"tr",13)(1,"td",41),c(2,"app-no-data-found-banner"),o()())}function ge(r,m){if(r&1){let e=y();n(0,"div",2)(1,"div",3)(2,"h2",4),l(3,"Motor Insurance Requests"),o()(),n(4,"div",5)(5,"span",6),c(6,"i",7),n(7,"input",8),S("input",function(i){x(e);let s=h();return C(s.onGlobalFilter(i))}),o()()(),n(8,"p-table",9,0),S("onSort",function(i){x(e);let s=h();return C(s.onSort(i))})("onPage",function(i){x(e);let s=h();return C(s.onPageChange(i))}),v(10,me,33,6,"ng-template",10)(11,he,31,23,"ng-template",11)(12,_e,3,0,"ng-template",12),o()()}if(r&2){let e=h();a(8),_("paginator",!0)("rows",e.rowsPerPage)("totalRecords",e.totalRecords)("rowsPerPageOptions",e.getPagination())("showCurrentPageReport",!0)("value",e.filteredRequests)("sortMode","single")}}var ke=(()=>{class r{constructor(){this.ngxSpinnerService=f(Q),this.messageService=f(w),this.motorRequestsService=f(z),this.route=f($),this.cdRef=f(k),this.requests=[],this.filteredRequests=[],this.totalRecords=0,this.rowsPerPage=10,this.selectedStatus=null,this.selectedRequestType=null,this.requestTypeOptions=[],this.statusSteps=["requested","pending","confirmed","canceled"],this.sortField=null,this.sortOrder=1,this.currentPage=1,this.selectOptions=[],this.isLoading=L(!1),this.searchSubject=new T}ngOnInit(){this.initDropDownFilter(),this.isLoading.set(!0),this.requests=this.route.snapshot.data.data.data.sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime()),this.isLoading.set(!1),this.initRequestTypeOptions(),this.applyFilters(),this.ngxSpinnerService.hide("actionsLoader"),this.setupSearchDebounce()}setupSearchDebounce(){this.searchSubject.pipe(M(300)).subscribe(e=>{this.applyGlobalFilter(e)})}initDropDownFilter(){this.selectOptions=[{label:"Requested",value:"requested",icon:"pi pi-inbox",color:"text-blue-600"},{label:"Pending",value:"pending",icon:"pi pi-clock",color:"text-yellow-600"},{label:"Confirmed",value:"confirmed",icon:"pi pi-check-circle",color:"text-green-600"},{label:"Canceled",value:"canceled",icon:"pi pi-times-circle",color:"text-red-600"}]}initRequestTypeOptions(){let e=[...new Set(this.requests.map(t=>t.request_type||"individual"))];this.requestTypeOptions=e.map(t=>({label:t.charAt(0).toUpperCase()+t.slice(1),value:t}))}getStatusClass(e){switch(e){case"confirmed":return"bg-green-200 text-green-800";case"canceled":return"bg-red-200 text-red-800";case"pending":return"bg-yellow-200 text-yellow-800";case"requested":return"bg-blue-200 text-blue-800";default:return""}}getAvailableStatusOptions(e){let t=this.statusSteps.indexOf(e);return this.selectOptions.filter(i=>!(e==="confirmed"&&i.value==="canceled")).map((i,s)=>R(q({},i),{disabled:s<t}))}applyFilters(){let e=[...this.requests];this.selectedStatus!==null&&(e=e.filter(t=>t.active_status===this.selectedStatus)),this.selectedRequestType!==null&&(e=e.filter(t=>(t.request_type||"individual")===this.selectedRequestType)),this.sortField&&e.sort((t,i)=>this.compareValues(t,i,this.sortField,this.sortOrder)),this.filteredRequests=e,this.totalRecords=e.length,this.cdRef.detectChanges()}onGlobalFilter(e){let i=e.target.value.trim().toLowerCase();this.searchSubject.next(i)}applyGlobalFilter(e){let t=[...this.requests];this.selectedStatus!==null&&(t=t.filter(i=>i.active_status===this.selectedStatus)),this.selectedRequestType!==null&&(t=t.filter(i=>(i.request_type||"individual")===this.selectedRequestType)),e&&(t=t.filter(i=>(i.id?.toString().toLowerCase()||"").includes(e)||(i.name?.toLowerCase()||"").includes(e)||(i.email?.toLowerCase()||"").includes(e)||(i.phone?.toString().toLowerCase()||"").includes(e)||(i.active_status?.toLowerCase()||"").includes(e)||(i.car_type?.toLowerCase()||"").includes(e)||(i.car_brand?.toLowerCase()||"").includes(e)||(i.car_model?.toLowerCase()||"").includes(e)||(i.request_type?.toLowerCase()||"").includes(e))),this.sortField&&t.sort((i,s)=>this.compareValues(i,s,this.sortField,this.sortOrder)),this.filteredRequests=t,this.totalRecords=t.length,this.dt.first=0,this.currentPage=1,this.cdRef.detectChanges()}compareValues(e,t,i,s){if(!i)return 0;let p=e[i],d=t[i];return i==="id"||i==="phone"?(p=p?Number(p):null,d=d?Number(d):null):i==="created_at"||i==="updated_at"||i==="start_date"||i==="end_date"?(p=p?new Date(p):null,d=d?new Date(d):null):(p=p?p.toString().toLowerCase():"",d=d?d.toString().toLowerCase():""),p==null||p===""?s*-1:d==null||d===""?s*1:p<d?s*-1:p>d?s*1:0}onFilterChange(e){this.selectedStatus=e,this.applyFilters()}onRequestTypeFilterChange(e){this.selectedRequestType=e,this.applyFilters()}onSort(e){this.sortField=e.field,this.sortOrder=e.order,this.applyFilters()}onPageChange(e){this.currentPage=e.page+1}updateRequestStatus(e,t){this.ngxSpinnerService.show("actionsLoader"),(t==="canceled"?this.motorRequestsService.cancel(e.id):this.motorRequestsService.changeStatus(e.id,t)).subscribe({next:s=>{e.active_status=s.data.active_status,this.applyFilters(),this.messageService.add({severity:"success",summary:"Updated",detail:s.message}),this.ngxSpinnerService.hide("actionsLoader")},error:()=>{this.messageService.add({severity:"error",summary:"Error",detail:"Failed to update request status"}),this.ngxSpinnerService.hide("actionsLoader")}})}getPagination(){let e=this.filteredRequests.length;return[10,25,50,100,e].filter(t=>t<=e)}formatDate(e){return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"})}getStatusLabel(e){let t=this.selectOptions.find(i=>i.value===e);return t?t.label:e}getStatusIcon(e){let t=this.selectOptions.find(i=>i.value===e);return t?t.icon:""}getStatusColor(e){let t=this.selectOptions.find(i=>i.value===e);return t?t.color:""}static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275cmp=F({type:r,selectors:[["app-all-motors-requests"]],viewQuery:function(t,i){if(t&1&&I(ae,5),t&2){let s;P(s=O())&&(i.dt=s.first)}},standalone:!0,features:[V([w]),j],decls:3,vars:1,consts:[["dt",""],["requestTypeFilter",""],[1,"card","overflow-x-auto"],[1,"flex","justify-between","items-center","mb-3"],[1,"text-2xl","font-semibold"],[1,"mb-3","flex","justify-content-end","gap-3"],[1,"p-input-icon-right"],[1,"pi","pi-search"],["type","text","pInputText","","placeholder","Search requests...",3,"input"],["responsiveLayout","scroll",3,"onSort","onPage","paginator","rows","totalRecords","rowsPerPageOptions","showCurrentPageReport","value","sortMode"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[1,"text-center"],["pSortableColumn","id",1,"text-center"],["field","id"],["pSortableColumn","name",1,"text-center"],["field","name"],["pSortableColumn","phone",1,"text-center"],["field","phone"],["pSortableColumn","car_type",1,"text-center"],["field","car_type"],["pSortableColumn","car_brand",1,"text-center"],["field","car_brand"],["pSortableColumn","car_model",1,"text-center"],["field","car_model"],["styleClass","mx-auto","optionLabel","label","optionValue","value","placeholder","Request Type",1,"mx-auto","max-w-[120px]",3,"onChange","options","showClear","autoZIndex"],["pSortableColumn","created_at",1,"text-center"],["field","created_at"],["optionLabel","label","optionValue","value","placeholder","Filter by Status",3,"onChange","options","showClear","autoZIndex"],["pTemplate","selectedItem"],["pTemplate","item"],[1,"flex","items-center","justify-center"],[1,"mr-2"],[3,"routerLink"],[1,"pi","pi-comments"],[3,"ngClass"],[1,"flex","items-center","justify-center","border","rounded","px-2","bg-white","py-3"],[1,"flex","gap-2","items-center"],[1,"pi","pi-pencil"],[1,"pi","pi-eye"],["colspan","11"]],template:function(t,i){t&1&&(c(0,"p-toast"),v(1,pe,1,0,"app-loading-data-banner")(2,ge,13,7)),t&2&&(a(),E(1,i.isLoading()?1:2))},dependencies:[J,U,Y,X,ne,ee,te,ie,W,K,G,oe,re,B,N,H,Z],styles:["tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{text-align:center}"]})}}return r})();export{ke as AllMotorsRequestsComponent};
