import{a as G}from"./chunk-EEQJPE73.js";import{a as ee,b as te,c as ie,d as ne}from"./chunk-2CYVADF6.js";import"./chunk-ULFGH5XU.js";import{a as re}from"./chunk-Y6SZKX5H.js";import{b as W}from"./chunk-4WY6IZPL.js";import{d as X,e as Y}from"./chunk-WDDFHKIH.js";import"./chunk-AGVKSH7H.js";import{p as z}from"./chunk-V2NMUT4R.js";import{a as oe}from"./chunk-2O7EOZOI.js";import{a as Q,c as Z}from"./chunk-KEBJO4LJ.js";import{d as J,e as K}from"./chunk-PEYIU4ER.js";import"./chunk-RJZ3H7D5.js";import"./chunk-5YI4S6VK.js";import{f as H}from"./chunk-PXM2JOVS.js";import{C as U,x as w}from"./chunk-27E65EIB.js";import{b as B,e as $}from"./chunk-67M3DXMG.js";import{h as N,n as j}from"./chunk-FYJ5Y7AH.js";import{$a as E,Ab as m,Gb as L,Hb as O,Ib as A,Jb as q,Kb as d,Lb as h,Mb as D,Qa as l,Ra as F,Rb as M,Sb as V,Ub as y,Y as v,ba as P,fb as S,hb as _,ka as f,la as x,lb as g,mb as I,mc as k,qb as o,rb as a,sb as c,wb as b,zb as C}from"./chunk-PSXZOWGB.js";import{a as R,b as T}from"./chunk-PSFXZ2QL.js";var se=["dt"],le=r=>["/dashboard/menu/building-request/comments",r],pe=r=>["/dashboard/menu/building-requests/edit",r],de=r=>["/dashboard/menu/building-requests/view-building-request",r];function ce(r,u){r&1&&c(0,"app-loading-data-banner")}function ue(r,u){if(r&1&&(o(0,"div",28),c(1,"i",29),o(2,"span"),d(3),a()()),r&2){let e=u.$implicit;l(),g(e.icon+" "+e.color),l(),g(e.color),l(),h(e.label)}}function me(r,u){if(r&1&&(o(0,"div",28),c(1,"i",29),o(2,"span"),d(3),a()()),r&2){let e=u.$implicit;l(),g(e.icon+" "+e.color),l(),g(e.color),l(),h(e.label)}}function he(r,u){if(r&1){let e=b();o(0,"tr",13)(1,"th",14),d(2," ID "),c(3,"p-sortIcon",15),a(),o(4,"th",16),d(5," Name "),c(6,"p-sortIcon",17),a(),o(7,"th",18),d(8," Email "),c(9,"p-sortIcon",19),a(),o(10,"th",20),d(11," Phone "),c(12,"p-sortIcon",21),a(),o(13,"th",13)(14,"p-dropdown",22,1),C("onChange",function(i){f(e);let n=q(15);return m(2).onRequestTypeFilterChange(i.value),x(n.showClear=!0)}),a()(),o(16,"th",23),d(17," Created "),c(18,"p-sortIcon",24),a(),o(19,"th",13),d(20,"Comments"),a(),o(21,"th",13)(22,"p-dropdown",25),C("onChange",function(i){f(e);let n=m(2);return x(n.onFilterChange(i.value))}),S(23,ue,4,5,"ng-template",26)(24,me,4,5,"ng-template",27),a()(),o(25,"th",13),d(26,"Actions"),a()()}if(r&2){let e=m(2);l(14),_("options",e.requestTypeOptions)("showClear",!0)("autoZIndex",!0),l(8),_("options",e.selectOptions)("showClear",!0)("autoZIndex",!0)}}function _e(r,u){if(r&1&&(o(0,"tr",13)(1,"td"),d(2),a(),o(3,"td"),d(4),a(),o(5,"td"),d(6),a(),o(7,"td"),d(8),a(),o(9,"td"),d(10),a(),o(11,"td"),d(12),a(),o(13,"td")(14,"a",30),c(15,"i",31),a()(),o(16,"td",32)(17,"div",33),c(18,"i",29),o(19,"span"),d(20),a()()(),o(21,"td")(22,"div",34)(23,"a",30),c(24,"i",35),a(),o(25,"a",30),c(26,"i",36),a()()()()),r&2){let e=u.$implicit,t=m(2);l(2),h(e.id),l(2),h(e.name),l(2),h(e.email),l(2),h(e.phone),l(2),h(e.request_type||"individual"),l(2),h(t.formatDate(e.created_at)),l(2),_("routerLink",y(15,le,e.id)),l(2),_("ngClass",t.getStatusClass(e.active_status)),l(2),g(t.getStatusIcon(e.active_status)+" "+t.getStatusColor(e.active_status)),l(),g(t.getStatusColor(e.active_status)),l(),D(" ",t.getStatusLabel(e.active_status)," "),l(3),_("routerLink",y(17,pe,e.id)),l(2),_("routerLink",y(19,de,e.id))}}function ge(r,u){r&1&&(o(0,"tr",13)(1,"td",37),c(2,"app-no-data-found-banner"),a()())}function fe(r,u){if(r&1){let e=b();o(0,"div",2)(1,"div",3)(2,"h2",4),d(3,"Property Requests"),a()(),o(4,"div",5)(5,"span",6),c(6,"i",7),o(7,"input",8),C("input",function(i){f(e);let n=q(9),p=m();return x(p.onGlobalFilter(n,i))}),a()()(),o(8,"p-table",9,0),C("onSort",function(i){f(e);let n=m();return x(n.onSort(i))})("onPage",function(i){f(e);let n=m();return x(n.onPageChange(i))}),S(10,he,27,6,"ng-template",10)(11,_e,27,21,"ng-template",11)(12,ge,3,0,"ng-template",12),a()()}if(r&2){let e=m();l(8),_("paginator",!0)("rows",e.rowsPerPage)("totalRecords",e.totalRecords)("rowsPerPageOptions",e.getPagination())("showCurrentPageReport",!0)("value",e.filteredRequests)("sortMode","multiple")}}var je=(()=>{class r{ngOnInit(){this.initDropDownFilter(),this.isLoading.set(!0),this.requests=this.route.snapshot.data.data.data.sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime()),this.isLoading.set(!1),console.log(this.isLoading()),console.log("requests:",this.requests),this.initRequestTypeOptions(),this.applyFilters(),this.ngxSpinnerService.hide("actionsLoader")}constructor(e){this.cdRef=e,this.ngxSpinnerService=v(Q),this.messageService=v(w),this.buildingRequestsService=v(G),this.route=v(B),this.isLoading=E(!1),this.requests=[],this.filteredRequests=[],this.totalRecords=0,this.rowsPerPage=10,this.selectedStatus=null,this.selectedRequestType=null,this.requestTypeOptions=[],this.statusSteps=["requested","pending","confirmed","canceled"],this.sortField=null,this.sortOrder=1,this.currentPage=1,this.selectOptions=[]}initDropDownFilter(){this.selectOptions=[{label:"Requested",value:"requested",icon:"pi pi-inbox",color:"text-blue-600"},{label:"Pending",value:"pending",icon:"pi pi-clock",color:"text-yellow-600"},{label:"Confirmed",value:"confirmed",icon:"pi pi-check-circle",color:"text-green-600"},{label:"Canceled",value:"canceled",icon:"pi pi-times-circle",color:"text-red-600"}]}initRequestTypeOptions(){let e=[...new Set(this.requests.map(t=>t.request_type||"individual"))];this.requestTypeOptions=e.map(t=>({label:t.charAt(0).toUpperCase()+t.slice(1),value:t}))}getStatusClass(e){switch(e){case"confirmed":return"bg-green-200 text-green-800";case"canceled":return"bg-red-200 text-red-800";case"pending":return"bg-yellow-200 text-yellow-800";case"requested":return"bg-blue-200 text-blue-800";default:return""}}getAvailableStatusOptions(e){let t=this.statusSteps.indexOf(e);return this.selectOptions.filter(i=>!(e==="confirmed"&&i.value==="canceled")).map((i,n)=>T(R({},i),{disabled:n<t}))}applyFilters(){let e=[...this.requests];this.selectedStatus!==null&&(e=e.filter(t=>t.active_status===this.selectedStatus)),this.selectedRequestType!==null&&(e=e.filter(t=>(t.request_type||"individual")===this.selectedRequestType)),this.sortField&&e.sort((t,i)=>this.compareValues(t,i,this.sortField,this.sortOrder)),this.filteredRequests=e,this.totalRecords=e.length}onGlobalFilter(e,t){let n=t.target.value.toLowerCase(),p=[...this.requests];this.selectedStatus!==null&&(p=p.filter(s=>s.active_status===this.selectedStatus)),this.selectedRequestType!==null&&(p=p.filter(s=>(s.request_type||"individual")===this.selectedRequestType)),n&&(p=p.filter(s=>s.id.toString().includes(n)||s.name.toLowerCase().includes(n)||s.email&&s.email.toLowerCase().includes(n)||s.phone&&s.phone.includes(n)||s.active_status.toLowerCase().includes(n)||s.request_type&&s.request_type.toLowerCase().includes(n))),this.sortField&&p.sort((s,ae)=>this.compareValues(s,ae,this.sortField,this.sortOrder)),this.filteredRequests=p,console.log("filtered data:",this.filteredRequests),this.totalRecords=p.length}compareValues(e,t,i,n){if(!i)return 0;let p=e[i],s=t[i];return i==="id"?(p=Number(p),s=Number(s)):(i==="created_at"||i==="updated_at")&&(p=new Date(p),s=new Date(s)),p==null?n*-1:s==null?n*1:p<s?n*-1:p>s?n*1:0}onFilterChange(e){this.selectedStatus=e,this.applyFilters()}onRequestTypeFilterChange(e){this.selectedRequestType=e,this.applyFilters()}onSort(e){this.sortField=e.field,this.sortOrder=e.order,this.applyFilters()}onPageChange(e){this.currentPage=e.page+1}updateRequestStatus(e,t){this.ngxSpinnerService.show("actionsLoader"),(t==="canceled"?this.buildingRequestsService.cancel(e.id):this.buildingRequestsService.changeStatus(e.id,t)).subscribe({next:n=>{e.active_status=n.data.active_status,this.applyFilters(),this.messageService.add({severity:"success",summary:"Updated",detail:n.message}),this.ngxSpinnerService.hide("actionsLoader")},error:()=>{this.messageService.add({severity:"error",summary:"Error",detail:"Failed to update request status"}),this.ngxSpinnerService.hide("actionsLoader")}})}getPagination(){let e=this.filteredRequests.length;return[10,25,50,100,e].filter(t=>t<=e)}formatDate(e){return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"})}getStatusLabel(e){let t=this.selectOptions.find(i=>i.value===e);return t?t.label:e}getStatusIcon(e){let t=this.selectOptions.find(i=>i.value===e);return t?t.icon:""}getStatusColor(e){let t=this.selectOptions.find(i=>i.value===e);return t?t.color:""}static{this.\u0275fac=function(t){return new(t||r)(F(k))}}static{this.\u0275cmp=P({type:r,selectors:[["app-all-property-requests"]],viewQuery:function(t,i){if(t&1&&L(se,5),t&2){let n;O(n=A())&&(i.dt=n.first)}},standalone:!0,features:[M([w]),V],decls:3,vars:1,consts:[["dt",""],["requestTypeFilter",""],[1,"card","overflow-x-auto"],[1,"flex","justify-between","items-center","mb-3"],[1,"text-2xl","font-semibold"],[1,"mb-3","flex","justify-content-end","gap-3"],[1,"p-input-icon-right"],[1,"pi","pi-search"],["type","text","pInputText","","placeholder","Search requests...",3,"input"],["responsiveLayout","scroll",3,"onSort","onPage","paginator","rows","totalRecords","rowsPerPageOptions","showCurrentPageReport","value","sortMode"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[1,"text-center"],["pSortableColumn","id",1,"text-center"],["field","id"],["pSortableColumn","name",1,"text-center"],["field","name"],["pSortableColumn","email",1,"text-center"],["field","email"],["pSortableColumn","phone",1,"text-center"],["field","phone"],["styleClass","mx-auto","optionLabel","label","optionValue","value","placeholder","Request Type",1,"mx-auto","max-w-[120px]",3,"onChange","options","showClear","autoZIndex"],["pSortableColumn","created_at",1,"text-center"],["field","created_at"],["optionLabel","label","optionValue","value","placeholder","Filter by Status",3,"onChange","options","showClear","autoZIndex"],["pTemplate","selectedItem"],["pTemplate","item"],[1,"flex","items-center","justify-center"],[1,"mr-2"],[3,"routerLink"],[1,"pi","pi-comments"],[3,"ngClass"],[1,"flex","items-center","justify-center","border","rounded","px-2","bg-white","py-3"],[1,"flex","gap-2","items-center"],[1,"pi","pi-pencil"],[1,"pi","pi-eye"],["colspan","8"]],template:function(t,i){t&1&&(c(0,"p-toast"),S(1,ce,1,0,"app-loading-data-banner")(2,fe,13,7)),t&2&&(l(),I(1,i.isLoading()?1:2))},dependencies:[H,U,Y,X,ne,ee,te,ie,K,J,$,oe,re,j,N,z,Z,W]})}}return r})();export{je as AllPropertyRequestsComponent};
