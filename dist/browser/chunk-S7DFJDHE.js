import{f as k}from"./chunk-PXM2JOVS.js";import{x as D}from"./chunk-27E65EIB.js";import{i as w,j as F,n as S}from"./chunk-FYJ5Y7AH.js";import{Ab as m,Kb as g,Lb as y,Ma as I,Qa as d,Ra as O,Sb as z,ba as v,fb as f,hb as l,ja as C,jb as _,ka as x,la as b,qb as a,rb as r,sa as M,sb as p,wb as P,zb as u}from"./chunk-PSXZOWGB.js";import{h}from"./chunk-PSFXZ2QL.js";function U(o,c){o&1&&(a(0,"div",11),p(1,"div",12),a(2,"p"),g(3,"Loading images..."),r()())}function E(o,c){o&1&&(a(0,"div",20),p(1,"div",12),r())}function T(o,c){if(o&1){let e=P();a(0,"button",21),u("click",function(){x(e);let t=m().index,i=m();return b(i.removeImage(t))}),p(1,"i",22),r()}if(o&2){let e=m().$implicit,n=m();l("disabled",n.isDeleting[e.id])}}function V(o,c){if(o&1&&(a(0,"div",13)(1,"div",14),f(2,E,2,0,"div",15),p(3,"img",16),a(4,"div",17)(5,"span",18),g(6),r()(),f(7,T,2,1,"button",19),r()()),o&2){let e=c.$implicit,n=m();_("deleting",n.isDeleting[e.id]),d(2),l("ngIf",n.isDeleting[e.id]),d(),l("src",e.image,I),d(3),y(e.is_main?"Main Image":"Secondary"),d(),l("ngIf",!n.singleImageMode)}}function B(o,c){o&1&&(a(0,"div",23)(1,"p"),g(2,"No images added yet"),r()())}var Y=(()=>{class o{constructor(e){this.messageService=e,this.initialImages=[],this.singleImageMode=!1,this.id="default",this.imagesChanged=new M,this.isDeleting={},this.images=[],this.isDragging=!1,this.isLoading=!1,this.InputId="",this.removedUrls=new Set,this.addedFiles=[]}ngOnInit(){this.InputId=`file-input-${this.id}`,this.images=[...this.initialImages],this.emitChanges(),console.log("ngOnInit initialImages:",this.initialImages)}removeImage(e){return h(this,null,function*(){let t=this.getVisibleImages()[e];this.isDeleting[t.id.toString()]=!0;try{if(!t.created_at){this.images=this.images.filter(s=>s.id!==t.id);let i=this.addedFiles.findIndex(s=>s.name===t.image);i!==-1&&this.addedFiles.splice(i,1)}this.emitChanges()}catch{this.messageService.add({severity:"error",summary:"Error",detail:"Failed to delete image"})}finally{delete this.isDeleting[t.id.toString()]}})}ngOnChanges(e){e.initialImages&&e.initialImages.currentValue&&(this.images=[...e.initialImages.currentValue],this.emitChanges(),console.log("ngOnChanges initialImages:",this.initialImages))}onDragOver(e){e.preventDefault(),e.stopPropagation(),this.isDragging=!0}onDragLeave(e){e.preventDefault(),e.stopPropagation(),this.isDragging=!1}onDrop(e){e.preventDefault(),e.stopPropagation(),this.isDragging=!1,e.dataTransfer?.files&&this.handleFiles(e.dataTransfer.files)}onFileSelected(e){let n=e.target;n.files&&(this.handleFiles(n.files),n.value="")}handleFiles(e){let n=Array.from(e).filter(t=>t.type.startsWith("image/"));if(n.length!==0){if(this.singleImageMode){this.images.forEach(i=>{i.active_status&&i.image&&(i.active_status=!1,this.removedUrls.add(i.image))}),this.images=this.images.filter(i=>!i.created_at),this.addedFiles=[];let t=n[0];this.addImageFile(t)}else n.forEach(t=>this.addImageFile(t));this.emitChanges()}}addImageFile(e){let n=new FileReader;n.onload=t=>{let i={id:`new-${Date.now()}-${Math.random().toString(36).substring(2,9)}`,image:t.target?.result,is_main:this.images.length===0,active_status:!0,created_at:"",updated_at:""};this.images.push(i),this.addedFiles.push(e),this.emitChanges()},n.readAsDataURL(e)}emitChanges(){let e=Array.from(this.removedUrls);this.imagesChanged.emit({added:[...this.addedFiles],removed:e})}formatFileSize(e){if(e===0)return"0 Bytes";let n=1024,t=["Bytes","KB","MB","GB"],i=Math.floor(Math.log(e)/Math.log(n));return parseFloat((e/Math.pow(n,i)).toFixed(2))+" "+t[i]}getVisibleImages(){return this.images.filter(e=>e.active_status)}static{this.\u0275fac=function(n){return new(n||o)(O(D))}}static{this.\u0275cmp=v({type:o,selectors:[["app-image-upload"]],inputs:{initialImages:"initialImages",singleImageMode:"singleImageMode",id:"id"},outputs:{imagesChanged:"imagesChanged"},standalone:!0,features:[C,z],decls:16,vars:8,consts:[[1,"image-upload-container"],["class","loading-overlay",4,"ngIf"],[1,"image-preview-container"],["class","image-card",3,"deleting",4,"ngFor","ngForOf"],["class","empty-state",4,"ngIf"],[1,"dropzone",3,"dragover","dragleave","drop"],[1,"dropzone-content"],[1,"pi","pi-cloud-upload"],[1,"or-text"],[1,"file-upload-label",3,"for"],["type","file","accept","image/*",1,"file-input",3,"change","id","multiple"],[1,"loading-overlay"],[1,"spinner"],[1,"image-card"],[1,"card-content"],["class","deleting-overlay",4,"ngIf"],[1,"preview-image",3,"src"],[1,"image-info"],[1,"image-size"],["type","button","class","remove-btn","title","Remove image",3,"disabled","click",4,"ngIf"],[1,"deleting-overlay"],["type","button","title","Remove image",1,"remove-btn",3,"click","disabled"],[1,"pi","pi-times"],[1,"empty-state"]],template:function(n,t){n&1&&(a(0,"div",0),f(1,U,4,0,"div",1),a(2,"div",2),f(3,V,8,6,"div",3)(4,B,3,0,"div",4),r(),a(5,"div",5),u("dragover",function(s){return t.onDragOver(s)})("dragleave",function(s){return t.onDragLeave(s)})("drop",function(s){return t.onDrop(s)}),a(6,"div",6),p(7,"i",7),a(8,"p"),g(9,"Drag & Drop your images here"),r(),a(10,"span",8),g(11,"or"),r(),a(12,"label",9)(13,"span"),g(14,"Browse Files"),r(),a(15,"input",10),u("change",function(s){return t.onFileSelected(s)}),r()()()()()),n&2&&(d(),l("ngIf",t.isLoading),d(2),l("ngForOf",t.getVisibleImages()),d(),l("ngIf",t.getVisibleImages().length===0),d(),_("dragover",t.isDragging),d(7),l("for",t.InputId),d(3),l("id",t.InputId)("multiple",!t.singleImageMode))},dependencies:[S,w,F,k],styles:['.restore-btn[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background-color:#2196f3;color:#fff;border:none;padding:5px 10px;border-radius:3px;cursor:pointer;z-index:2}.restore-btn[_ngcontent-%COMP%]:hover{background-color:#0b7dda}.deleted-images-section[_ngcontent-%COMP%]{margin-bottom:20px;padding:15px;background-color:#fff4f4;border-radius:5px;border-left:3px solid #ff5252}.deleted-images-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-top:0;color:#d32f2f;font-size:16px}.dropzone[_ngcontent-%COMP%]{border:2px dashed #ccc;border-radius:5px;padding:30px;text-align:center;transition:all .3s;margin-bottom:20px}.dropzone.dragover[_ngcontent-%COMP%]{background-color:#f0f8ff;border-color:#2196f3}.dropzone[_ngcontent-%COMP%]   .dropzone-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.dropzone[_ngcontent-%COMP%]   .dropzone-content[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{margin-bottom:10px;color:#666}.dropzone[_ngcontent-%COMP%]   .dropzone-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 10px;color:#666}.dropzone[_ngcontent-%COMP%]   .dropzone-content[_ngcontent-%COMP%]   .or-text[_ngcontent-%COMP%]{margin:10px 0;color:#999;position:relative}.dropzone[_ngcontent-%COMP%]   .dropzone-content[_ngcontent-%COMP%]   .or-text[_ngcontent-%COMP%]:before, .dropzone[_ngcontent-%COMP%]   .dropzone-content[_ngcontent-%COMP%]   .or-text[_ngcontent-%COMP%]:after{content:"";position:absolute;top:50%;width:50px;height:1px;background-color:#ddd}.dropzone[_ngcontent-%COMP%]   .dropzone-content[_ngcontent-%COMP%]   .or-text[_ngcontent-%COMP%]:before{right:100%;margin-right:10px}.dropzone[_ngcontent-%COMP%]   .dropzone-content[_ngcontent-%COMP%]   .or-text[_ngcontent-%COMP%]:after{left:100%;margin-left:10px}.dropzone[_ngcontent-%COMP%]   .file-upload-label[_ngcontent-%COMP%]{background-color:#2196f3;color:#fff;padding:10px 20px;border-radius:4px;cursor:pointer;transition:background-color .3s}.dropzone[_ngcontent-%COMP%]   .file-upload-label[_ngcontent-%COMP%]:hover{background-color:#0b7dda}.dropzone[_ngcontent-%COMP%]   .file-upload-label[_ngcontent-%COMP%]   .file-input[_ngcontent-%COMP%]{display:none}.image-upload-container[_ngcontent-%COMP%]{font-family:Arial,sans-serif;max-width:100%}.image-preview-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:15px;margin-bottom:20px}.image-card[_ngcontent-%COMP%]{width:120px;border:1px solid #ddd;border-radius:8px;overflow:hidden;position:relative;transition:all .3s ease}.image-card[_ngcontent-%COMP%]:hover{box-shadow:0 4px 8px #0000001a;transform:translateY(-2px)}.card-content[_ngcontent-%COMP%]{position:relative;height:100%}.preview-image[_ngcontent-%COMP%]{width:100%;height:80px;object-fit:cover;display:block}.image-info[_ngcontent-%COMP%]{padding:8px;font-size:12px;background:#f9f9f9}.image-name[_ngcontent-%COMP%]{display:block;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.image-size[_ngcontent-%COMP%]{color:#666;font-size:11px}.remove-btn[_ngcontent-%COMP%]{position:absolute;top:5px;right:5px;width:20px;height:20px;background:#000000b3;color:#fff;border:none;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;padding:0}.remove-btn[_ngcontent-%COMP%]:hover{background:#f00c}.image-card.deleting[_ngcontent-%COMP%]{opacity:.6;position:relative}.deleting-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background:#0000004d;display:flex;justify-content:center;align-items:center}.spinner[_ngcontent-%COMP%]{border:4px solid #f3f3f3;border-top:4px solid #3498db;border-radius:50%;width:24px;height:24px;animation:spin 1s linear infinite}']})}}return o})();export{Y as a};
