import{a as J}from"./chunk-37DZIZH7.js";import{a as oe,b as re,c as se,d as pe}from"./chunk-2CYVADF6.js";import"./chunk-ULFGH5XU.js";import{a as me}from"./chunk-Y6SZKX5H.js";import{b as ne}from"./chunk-4WY6IZPL.js";import{d as le,e as ae}from"./chunk-WDDFHKIH.js";import"./chunk-AGVKSH7H.js";import{e as K,j as X,p as Y}from"./chunk-V2NMUT4R.js";import{a as de}from"./chunk-2O7EOZOI.js";import{a as U,c as z}from"./chunk-KEBJO4LJ.js";import{d as te,e as ie}from"./chunk-PEYIU4ER.js";import"./chunk-RJZ3H7D5.js";import"./chunk-5YI4S6VK.js";import{f as ee}from"./chunk-PXM2JOVS.js";import{C as H,x as T}from"./chunk-27E65EIB.js";import{b as W,e as G}from"./chunk-67M3DXMG.js";import{h as q,n as Q}from"./chunk-FYJ5Y7AH.js";import{$a as A,Ab as _,Gb as L,Hb as V,Ib as D,Jb as O,Kb as d,Lb as u,Ob as R,Pb as N,Qa as o,Qb as $,Ra as M,Rb as j,Sb as k,Tb as b,Ub as w,Y as v,ba as I,fb as x,hb as g,ka as h,kb as B,la as f,lb as C,mb as P,mc as Z,qb as a,rb as r,sb as c,wb as y,zb as S}from"./chunk-PSXZOWGB.js";import{a as F,b as E}from"./chunk-PSFXZ2QL.js";var ue=["dt"],_e=()=>({"min-width":"70rem"}),ge=t=>["/dashboard/menu/building-claims/comments",t],Ce=()=>({width:"100%"}),he=t=>["/dashboard/menu/building-claims/view-building-claim",t];function fe(t,m){t&1&&c(0,"app-loading-data-banner")}function xe(t,m){if(t&1&&(a(0,"div",30),c(1,"i",31),a(2,"span"),d(3),r()()),t&2){let e=m.$implicit;o(),C(e.icon+" "+e.color),o(),C(e.color),o(),u(e.label)}}function Se(t,m){if(t&1&&(a(0,"div",30),c(1,"i",31),a(2,"span"),d(3),r()()),t&2){let e=m.$implicit;o(),C(e.icon+" "+e.color),o(),C(e.color),o(),u(e.label)}}function ve(t,m){if(t&1&&(a(0,"span"),d(1),r()),t&2){let e=m.$implicit;o(),u(e.label)}}function ye(t,m){if(t&1&&(a(0,"span"),d(1),r()),t&2){let e=m.$implicit;o(),u(e.label)}}function be(t,m){if(t&1){let e=y();a(0,"tr",13)(1,"th",14),d(2," ID "),c(3,"p-sortIcon",15),r(),a(4,"th",16),d(5," Name "),c(6,"p-sortIcon",17),r(),a(7,"th",18),d(8," Email "),c(9,"p-sortIcon",19),r(),a(10,"th",20),d(11," Phone "),c(12,"p-sortIcon",21),r(),a(13,"th",22),d(14," Created "),c(15,"p-sortIcon",23),r(),a(16,"th",13),d(17,"Comments"),r(),a(18,"th",24)(19,"p-dropdown",25),S("onChange",function(n){h(e);let l=_(2);return f(l.onFilterChange(n.value))}),x(20,xe,4,5,"ng-template",26)(21,Se,4,5,"ng-template",27),r()(),a(22,"th",28)(23,"p-dropdown",29),S("onChange",function(n){h(e);let l=_(2);return f(l.onTypeFilterChange(n.value))}),x(24,ve,2,1,"ng-template",26)(25,ye,2,1,"ng-template",27),r()(),a(26,"th",13),d(27,"Actions"),r()()}if(t&2){let e=_(2);o(19),g("options",e.selectOptions)("showClear",!0)("autoZIndex",!0),o(4),g("options",e.typeOptions)("showClear",!0)("autoZIndex",!0)}}function we(t,m){if(t&1&&(a(0,"div",30),c(1,"i",31),a(2,"span"),d(3),r()()),t&2){let e=m.$implicit;o(),C(e.icon+" "+e.color),o(),C(e.color),o(),u(e.label)}}function Te(t,m){if(t&1&&(a(0,"div",30),c(1,"i",31),a(2,"span"),d(3),r()()),t&2){let e=m.$implicit;o(),C(e.icon+" "+e.color),o(),C(e.color),o(),u(e.label)}}function Fe(t,m){if(t&1){let e=y();a(0,"tr",13)(1,"td"),d(2),r(),a(3,"td"),d(4),r(),a(5,"td"),d(6),r(),a(7,"td"),d(8),r(),a(9,"td"),d(10),r(),a(11,"td")(12,"a",32),c(13,"i",33),r()(),a(14,"td",34)(15,"p-dropdown",35),$("ngModelChange",function(n){let l=h(e).$implicit;return N(l.status,n)||(l.status=n),f(n)}),S("onChange",function(n){let l=h(e).$implicit,p=_(2);return f(p.updateClaimStatus(l,n.value))}),x(16,we,4,5,"ng-template",26)(17,Te,4,5,"ng-template",27),r()(),a(18,"td"),d(19),r(),a(20,"td")(21,"div",36)(22,"a",32),c(23,"i",37),r()()()()}if(t&2){let e=m.$implicit,i=_(2);o(2),u(e.id),o(2),u(e.name),o(2),u(e.email),o(2),u(e.phone),o(2),u(i.formatDate(e.created_at)),o(2),g("routerLink",w(15,ge,e.id)),o(2),g("ngClass",i.getStatusClass(e.status)),o(),B(b(17,Ce)),g("options",i.getAvailableStatusOptions(e.status)),R("ngModel",e.status),g("autoZIndex",!0)("appendTo","body"),o(4),u(i.getClaimType(e)),o(3),g("routerLink",w(18,he,e.id))}}function Ee(t,m){t&1&&(a(0,"tr",13)(1,"td",38),c(2,"app-no-data-found-banner"),r()())}function Ie(t,m){if(t&1){let e=y();a(0,"div",1)(1,"div",2)(2,"h2",3),d(3,"Property Claims"),r()(),a(4,"div",4)(5,"span",5),c(6,"i",6),a(7,"input",7),S("input",function(n){h(e);let l=O(10),p=_();return f(p.onGlobalFilter(l,n))}),r()()(),a(8,"div",8)(9,"p-table",9,0),S("onSort",function(n){h(e);let l=_();return f(l.onSort(n))})("onPage",function(n){h(e);let l=_();return f(l.onPageChange(n))}),x(11,be,28,6,"ng-template",10)(12,Fe,24,20,"ng-template",11)(13,Ee,3,0,"ng-template",12),r()()()}if(t&2){let e=_();o(9),g("paginator",!0)("rows",e.rowsPerPage)("totalRecords",e.totalRecords)("rowsPerPageOptions",e.getPagination())("showCurrentPageReport",!0)("value",e.filteredClaims)("tableStyle",b(8,_e))("sortMode","multiple")}}var Xe=(()=>{class t{ngOnInit(){this.initDropDownFilter(),this.initTypeFilter(),this.isLoading.set(!0),this.claims=this.route.snapshot.data.data?.data||[],this.isLoading.set(!1),this.applyFilters(),this.ngxSpinnerService.hide("actionsLoader")}ngAfterViewInit(){console.log("Table reference:",this.dt)}constructor(e){this.cdRef=e,this.ngxSpinnerService=v(U),this.messageService=v(T),this.buildingClaimsService=v(J),this.route=v(W),this.claims=[],this.isLoading=A(!1),this.filteredClaims=[],this.totalRecords=0,this.rowsPerPage=10,this.selectedStatus=null,this.selectedType=null,this.statusSteps=["requested","pending","confirmed","canceled"],this.sortField=null,this.sortOrder=1,this.currentPage=1,this.selectOptions=[],this.typeOptions=[]}initDropDownFilter(){this.selectOptions=[{label:"Requested",value:"requested",icon:"pi pi-inbox",color:"text-blue-600"},{label:"Pending",value:"pending",icon:"pi pi-clock",color:"text-yellow-600"},{label:"Confirmed",value:"confirmed",icon:"pi pi-check-circle",color:"text-green-600"},{label:"Canceled",value:"canceled",icon:"pi pi-times-circle",color:"text-red-600"}]}initTypeFilter(){this.typeOptions=[{label:"Manual",value:"manual"},{label:"Ordinary",value:"ordinary"}]}getStatusClass(e){switch(e){case"confirmed":return"bg-green-200 text-green-800";case"canceled":return"bg-red-200 text-red-800";case"pending":return"bg-yellow-200 text-yellow-800";case"requested":return"bg-blue-200 text-blue-800";default:return""}}getClaimType(e){return e.building_insurance_id?"Ordinary":"Manual"}getAvailableStatusOptions(e){let i=this.statusSteps.indexOf(e);return this.selectOptions.filter(n=>!(e==="confirmed"&&n.value==="canceled")).map((n,l)=>E(F({},n),{disabled:l<i}))}applyFilters(){let e=[...this.claims];this.selectedStatus!==null&&(e=e.filter(i=>i.status===this.selectedStatus)),this.selectedType!==null&&(e=e.filter(i=>this.selectedType==="manual"?i.building_insurance_id===null:i.building_insurance_id!==null)),this.sortField&&e.sort((i,n)=>this.compareValues(i,n,this.sortField,this.sortOrder)),this.filteredClaims=e,this.totalRecords=e.length}onGlobalFilter(e,i){let l=i.target.value.toLowerCase(),p=[...this.claims];this.selectedStatus!==null&&(p=p.filter(s=>s.status===this.selectedStatus)),this.selectedType!==null&&(p=p.filter(s=>this.selectedType==="manual"?s.building_insurance_id===null:s.building_insurance_id!==null)),l&&(p=p.filter(s=>s.id.toString().includes(l)||s.name.toLowerCase().includes(l)||s.email&&s.email.toLowerCase().includes(l)||s.phone&&s.phone.includes(l)||s.status.toLowerCase().includes(l)||this.getClaimType(s).toLowerCase().includes(l))),this.sortField&&p.sort((s,ce)=>this.compareValues(s,ce,this.sortField,this.sortOrder)),this.filteredClaims=p,this.totalRecords=p.length}compareValues(e,i,n,l){if(!n)return 0;let p=e[n],s=i[n];return n==="id"?(p=Number(p),s=Number(s)):n==="created_at"||n==="updated_at"?(p=new Date(p),s=new Date(s)):n==="type"&&(p=this.getClaimType(e),s=this.getClaimType(i)),p==null?l*-1:s==null?l*1:p<s?l*-1:p>s?l*1:0}onFilterChange(e){this.selectedStatus=e,this.applyFilters()}onTypeFilterChange(e){this.selectedType=e,this.applyFilters()}onSort(e){this.sortField=e.field,this.sortOrder=e.order,this.applyFilters()}onPageChange(e){this.currentPage=e.page+1}updateClaimStatus(e,i){this.ngxSpinnerService.show("actionsLoader");let n=new FormData;n.append("status",i),this.buildingClaimsService.update(e.id,n).subscribe({next:l=>{e.status=l.data.status,this.applyFilters(),this.messageService.add({severity:"success",summary:"Updated",detail:l.message}),this.ngxSpinnerService.hide("actionsLoader")},error:()=>{this.messageService.add({severity:"error",summary:"Error",detail:"Failed to update claim status"}),this.ngxSpinnerService.hide("actionsLoader")}})}getPagination(){let e=this.filteredClaims.length;return[10,25,50,100,e].filter(i=>i<=e)}formatDate(e){return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"})}static{this.\u0275fac=function(i){return new(i||t)(M(Z))}}static{this.\u0275cmp=I({type:t,selectors:[["app-all-building-claims"]],viewQuery:function(i,n){if(i&1&&L(ue,5),i&2){let l;V(l=D())&&(n.dt=l.first)}},standalone:!0,features:[j([T]),k],decls:3,vars:1,consts:[["dt",""],[1,"card"],[1,"flex","justify-between","items-center","mb-3"],[1,"text-2xl","font-semibold"],[1,"mb-3","flex","justify-content-end","gap-3"],[1,"p-input-icon-right"],[1,"pi","pi-search"],["type","text","pInputText","","placeholder","Search claims...",3,"input"],[1,"overflow-x-auto"],["responsiveLayout","scroll","currentPageReportTemplate","Showing {first} to {last} of {totalRecords} entries",3,"onSort","onPage","paginator","rows","totalRecords","rowsPerPageOptions","showCurrentPageReport","value","tableStyle","sortMode"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[1,"text-center"],["pSortableColumn","id",1,"text-center"],["field","id"],["pSortableColumn","name",1,"text-center"],["field","name"],["pSortableColumn","email",1,"text-center"],["field","email"],["pSortableColumn","phone",1,"text-center"],["field","phone"],["pSortableColumn","created_at",1,"text-center"],["field","created_at"],["pSortableColumn","status",1,"text-center"],["optionLabel","label","optionValue","value","placeholder","Filter by Status",3,"onChange","options","showClear","autoZIndex"],["pTemplate","selectedItem"],["pTemplate","item"],["pSortableColumn","type",1,"text-center"],["optionLabel","label","optionValue","value","placeholder","Filter by Type",3,"onChange","options","showClear","autoZIndex"],[1,"flex","items-center","justify-center"],[1,"mr-2"],[3,"routerLink"],[1,"pi","pi-comments"],[3,"ngClass"],["optionLabel","label","optionValue","value","styleClass","status-dropdown",3,"ngModelChange","onChange","options","ngModel","autoZIndex","appendTo"],[1,"flex","gap-2","items-center","justify-center"],[1,"pi","pi-eye"],["colspan","9"]],template:function(i,n){i&1&&(c(0,"p-toast"),x(1,fe,1,0,"app-loading-data-banner")(2,Ie,14,9)),i&2&&(o(),P(1,n.isLoading()?1:2))},dependencies:[ee,H,ae,le,pe,oe,re,se,ie,te,G,de,me,Q,q,Y,K,X,z,ne]})}}return t})();export{Xe as AllBuildingClaimsComponent};
