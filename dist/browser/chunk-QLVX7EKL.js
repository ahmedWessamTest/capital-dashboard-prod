import{a as N}from"./chunk-4IMXXL2Z.js";import{a as B}from"./chunk-DCM55A5P.js";import{a as X,b as Y,c as ee,d as te}from"./chunk-2CYVADF6.js";import"./chunk-ULFGH5XU.js";import{a as ne}from"./chunk-Y6SZKX5H.js";import"./chunk-4WY6IZPL.js";import{d as K,e as Q}from"./chunk-WDDFHKIH.js";import{a as G,b as Z}from"./chunk-NZNLV7ZF.js";import"./chunk-AGVKSH7H.js";import{e as k,j,p as z}from"./chunk-V2NMUT4R.js";import{a as ie}from"./chunk-2O7EOZOI.js";import{a as R}from"./chunk-KEBJO4LJ.js";import{d as H,e as J}from"./chunk-PEYIU4ER.js";import"./chunk-RJZ3H7D5.js";import"./chunk-5YI4S6VK.js";import{e as W,f as q}from"./chunk-PXM2JOVS.js";import{C as $,x as C}from"./chunk-27E65EIB.js";import{e as I}from"./chunk-67M3DXMG.js";import{n as D}from"./chunk-FYJ5Y7AH.js";import{$a as U,Ab as p,Kb as l,Lb as v,M as y,Ob as A,Pb as E,Qa as a,Qb as M,Rb as O,Sb as V,Ub as P,Y as _,ba as T,f as F,fb as S,hb as h,ka as c,la as d,mb as L,qb as o,rb as s,sb as m,wb as f,zb as g}from"./chunk-PSXZOWGB.js";import{a as w,b}from"./chunk-PSFXZ2QL.js";var re=r=>["/dashboard/menu/view-user",r];function oe(r,u){r&1&&m(0,"app-loading-data-banner")}function se(r,u){if(r&1){let e=f();o(0,"tr")(1,"th",14),l(2," ID "),m(3,"p-sortIcon",15),s(),o(4,"th",16),l(5," Name "),s(),o(6,"th",17),l(7," Email "),s(),o(8,"th",18)(9,"p-dropdown",19),M("ngModelChange",function(i){c(e);let n=p(2);return E(n.activeFilters.is_active,i)||(n.activeFilters.is_active=i),d(i)}),g("onChange",function(i){c(e);let n=p(2);return d(n.onFilterChange("is_active",i.value))}),s()(),o(10,"th",18),l(11,"Actions"),s()()}if(r&2){let e=p(2);a(9),h("options",e.statusOptions),A("ngModel",e.activeFilters.is_active),h("showClear",!0)("autoZIndex",!0)}}function ae(r,u){if(r&1){let e=f();o(0,"tr")(1,"td",18),l(2),s(),o(3,"td",18),l(4),s(),o(5,"td",18),l(6),s(),o(7,"td",18)(8,"p-inputSwitch",20),g("onChange",function(){let i=c(e).$implicit,n=p(2);return d(n.toggleStatus(i))}),s()(),o(9,"td",18)(10,"a",21),m(11,"p-button",22),s()()()}if(r&2){let e=u.$implicit;a(2),v(e.id),a(2),v(e.name),a(2),v(e.email),a(2),h("ngModel",e.is_active),a(2),h("routerLink",P(5,re,e.id))}}function le(r,u){r&1&&(o(0,"tr")(1,"td",23),m(2,"app-no-data-found-banner"),s()())}function me(r,u){if(r&1){let e=f();o(0,"div",2)(1,"div",3)(2,"h2",4),l(3,"Users Control"),s(),m(4,"p-button",5),s(),o(5,"div",6)(6,"span",7),m(7,"i",8),o(8,"input",9,0),g("input",function(i){c(e);let n=p();return d(n.onGlobalFilter(i))}),s()()(),o(10,"p-table",10,1),g("onSort",function(i){c(e);let n=p();return d(n.onSort(i))}),S(12,se,12,4,"ng-template",11)(13,ae,12,7,"ng-template",12)(14,le,3,0,"ng-template",13),s()()}if(r&2){let e=p();a(10),h("paginator",!0)("rows",e.rowsPerPage)("totalRecords",e.totalRecords)("rowsPerPageOptions",e.getPagination())("showCurrentPageReport",!0)("value",e.filteredUsers)}}var De=(()=>{class r{constructor(){this.users=[],this.destroy$=new F,this.filteredUsers=[],this.nameOptions=[],this.emailOptions=[],this.roleOptions=[],this.statusOptions=[{label:"Active",value:1},{label:"Deleted",value:0}],this.isLoading=U(!1),this.activeFilters={name:null,email:null,role:null,is_active:null},this.totalRecords=0,this.rowsPerPage=10,this.searchTerm="",this.userService=_(N),this.spinner=_(R),this.messageService=_(C),this.normalizeActiveStatusService=_(B)}ngOnInit(){this.isLoading.set(!0),this.spinner.show("actionsLoader"),this.userService.getAll().pipe(y(this.destroy$)).subscribe({next:e=>{this.users=e.data.map(t=>b(w({},t),{is_active:!this.normalizeActiveStatusService.normalizeActiveStatus(t.delete_status)})),this.filteredUsers=[...this.users],this.totalRecords=this.users.length,this.initFilterOptions(),this.spinner.hide("actionsLoader"),this.isLoading.set(!1)},error:()=>{this.showError("Failed to load users"),this.spinner.hide("actionsLoader"),this.isLoading.set(!1)}})}initFilterOptions(){this.nameOptions=this.getDistinctOptions(this.users,"name"),this.emailOptions=this.getDistinctOptions(this.users,"email"),this.roleOptions=this.getDistinctOptions(this.users,"role")}getDistinctOptions(e,t){return[...new Set(e.map(n=>n[t]))].filter(n=>n).map(n=>({label:String(n),value:n}))}applyFilters(){this.filteredUsers=this.users.filter(e=>this.matchesFilter(e,"name",this.activeFilters.name)&&this.matchesFilter(e,"email",this.activeFilters.email)&&this.matchesFilter(e,"role",this.activeFilters.role)&&this.matchesFilter(e,"is_active",this.activeFilters.is_active)&&this.matchesSearch(e)),this.totalRecords=this.filteredUsers.length}matchesFilter(e,t,i){return!i&&i!==0?!0:t==="is_active"?e.is_active===(i===1):e[t]?.toString()===i.toString()}matchesSearch(e){return this.searchTerm?[e.id.toString(),e.name,e.email||"",e.role,e.is_active?"active":"deleted"].some(i=>i.toLowerCase().includes(this.searchTerm.toLowerCase())):!0}onGlobalFilter(e){this.searchTerm=e.target.value,this.applyFilters()}onFilterChange(e,t){this.activeFilters[e]=t,this.applyFilters()}toggleStatus(e){this.spinner.show("actionsLoader");let t=e.is_active?1:0;(t?this.userService.delete(e.id):this.userService.activate(e.id)).subscribe({next:()=>{e.is_active=t?0:1,this.applyFilters(),this.showSuccess(`User ${e.is_active?"activated":"deleted"} successfully`),this.spinner.hide("actionsLoader")},error:()=>{this.showError("Failed to update user status"),this.spinner.hide("actionsLoader")}})}showSuccess(e){this.messageService.add({severity:"success",summary:"Success",detail:e})}showError(e){this.messageService.add({severity:"error",summary:"Error",detail:e})}getPagination(){let e=this.filteredUsers.length;return[10,25,50,100,e].filter(t=>t<=e)}onSort(e){this.filteredUsers.sort((t,i)=>{let n=t[e.field],x=i[e.field];return n==null?1:x==null?-1:(n<x?-1:1)*(e.order===1?1:-1)})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275cmp=T({type:r,selectors:[["app-all-users"]],standalone:!0,features:[O([C]),V],decls:3,vars:1,consts:[["search",""],["dt",""],[1,"card"],[1,"flex","justify-between","items-center","mb-3"],[1,"text-2xl","font-semibold"],["routerLink","/dashboard/menu/add-user","label","Add User","icon","pi pi-plus",1,"btn-main","text-white"],[1,"mb-3","flex","justify-content-end"],[1,"p-input-icon-right"],[1,"pi","pi-search"],["type","text","pInputText","","placeholder","Search users...",1,"mb-0",3,"input"],["responsiveLayout","scroll",3,"onSort","paginator","rows","totalRecords","rowsPerPageOptions","showCurrentPageReport","value"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["pSortableColumn","id",1,"text-center"],["field","id"],["pSortableColumn","name",1,"text-center"],["pSortableColumn","email",1,"text-center"],[1,"text-center"],["optionLabel","label","optionValue","value","placeholder","Status",3,"ngModelChange","onChange","options","ngModel","showClear","autoZIndex"],[3,"onChange","ngModel"],[3,"routerLink"],["icon","pi pi-eye",1,"p-button-text"],["colspan","6"]],template:function(t,i){t&1&&(m(0,"p-toast"),S(1,oe,1,0,"app-loading-data-banner")(2,me,15,6)),t&2&&(a(),L(1,i.isLoading()?1:2))},dependencies:[D,q,W,$,Q,K,z,k,j,Z,G,te,X,Y,ee,J,H,I,ie,ne]})}}return r})();export{De as AllUsersComponent};
