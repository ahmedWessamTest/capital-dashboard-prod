import{a as G}from"./chunk-DIHUSGI2.js";import{a as te}from"./chunk-Y6SZKX5H.js";import{b as W,e as H,f as Y,h as q,j as K,k as $,p as Q}from"./chunk-V2NMUT4R.js";import{a as ee}from"./chunk-2O7EOZOI.js";import{a as z,c as R}from"./chunk-KEBJO4LJ.js";import{d as X,e as Z}from"./chunk-PEYIU4ER.js";import{b as N}from"./chunk-RJZ3H7D5.js";import"./chunk-5YI4S6VK.js";import{x as k}from"./chunk-27E65EIB.js";import{b as L,e as j}from"./chunk-67M3DXMG.js";import{h as J,n as O}from"./chunk-FYJ5Y7AH.js";import{Ab as m,Kb as c,Lb as b,Ma as y,Mb as v,Nb as S,Ob as P,Pb as I,Qa as r,Qb as U,Rb as D,Sb as V,Tb as B,Vb as M,Y as C,ba as F,fb as h,hb as p,jb as E,ka as f,la as _,ma as g,mb as u,ob as T,pb as A,qb as i,rb as a,sb as d,wb as w,zb as x}from"./chunk-PSXZOWGB.js";import"./chunk-PSFXZ2QL.js";var ne=(t,s)=>s.id,ie=()=>["/dashboard/menu/jop-claims"],oe=(t,s)=>({"justify-end":t,"justify-start":s}),re=(t,s)=>({"bg-[#d9fdd3] rounded-br-sm":t,"bg-white rounded-bl-sm":s});function ae(t,s){t&1&&d(0,"app-loading-data-banner")}function se(t,s){t&1&&(i(0,"div",9),d(1,"app-no-data-found-banner"),a())}function le(t,s){if(t&1&&(i(0,"div",16)(1,"a",18),g(),i(2,"svg",19),d(3,"path",20),a(),c(4," View Attachment "),a()()),t&2){let e=m().$implicit,n=m(2);r(),p("href",n.IMAGE_BASE_URL+e.comment_file,y)}}function me(t,s){if(t&1&&(i(0,"div",10)(1,"div",11)(2,"div",12)(3,"span",13),c(4),a(),i(5,"span",14),c(6),a()(),i(7,"p",15),c(8),a(),h(9,le,5,1,"div",16),i(10,"div",17),c(11),a()()()),t&2){let e=s.$implicit,n=m(2);p("ngClass",M(9,oe,e.user_role!=="user",e.user_role==="user")),r(),p("ngClass",M(12,re,e.user_role!=="user",e.user_role==="user")),r(3),S(" ",e.user_role!=="user"?"Admin":"User",": ",e.user_name," "),r(2),b(n.formatDate(e.comment_date||e.created_at)),r(2),v(" ",e.comment," "),r(),u(9,e.comment_file?9:-1),r(2),S(" To: ",e.reciver_role=="user"?"User":"Admin"," (",e.reciver_name,") ")}}function ce(t,s){if(t&1&&(i(0,"div",9),T(1,me,12,15,"div",10,ne),a()),t&2){let e=m();r(),A(e.comments)}}function de(t,s){if(t&1&&d(0,"img",23),t&2){let e=m(2);p("src",e.getFilePreview(e.selectedFile),y)}}function pe(t,s){t&1&&(i(0,"div",30),g(),i(1,"svg",31),d(2,"path",32),a()())}function ue(t,s){if(t&1){let e=w();i(0,"div",5)(1,"div",21)(2,"div",22),h(3,de,1,1,"img",23)(4,pe,3,0),i(5,"div",24)(6,"span",25),c(7),a(),i(8,"span",26),c(9),a()()(),i(10,"button",27),x("click",function(){f(e);let o=m();return _(o.removeFile())}),g(),i(11,"svg",28),d(12,"path",29),a()()()()}if(t&2){let e=m();r(3),u(3,e.selectedFile.type.startsWith("image/")?3:4),r(4),b(e.selectedFile.name),r(2),b(e.formatFileSize(e.selectedFile.size))}}function ge(t,s){t&1&&(i(0,"p",8),c(1," You can only comment on claims with 'Pending' status. "),a())}function he(t,s){t&1&&(g(),i(0,"svg",40),d(1,"circle",41)(2,"path",42),a())}function fe(t,s){t&1&&(g(),i(0,"svg",43),d(1,"line",44)(2,"polygon",45),a())}function _e(t,s){if(t&1&&(i(0,"button",39),h(1,he,3,0,":svg:svg",40)(2,fe,3,0),a()),t&2){let e=m(2);p("disabled",e.sending||e.claimStatus!=="pending"),r(),u(1,e.sending?1:2)}}function Ce(t,s){if(t&1){let e=w();i(0,"div",33)(1,"textarea",34),U("ngModelChange",function(o){f(e);let l=m();return I(l.newComment,o)||(l.newComment=o),_(o)}),x("input",function(o){f(e);let l=m();return _(l.autoResize(o))})("keydown.enter",function(o){f(e);let l=m();return _(l.onEnterPress(o))}),c(2,"        "),a(),i(3,"div",35)(4,"label",36)(5,"input",37),x("change",function(o){f(e);let l=m();return _(l.onFileSelected(o))}),a(),g(),i(6,"svg",38),d(7,"path",20),a()(),h(8,_e,3,2,"button",39),a()()}if(t&2){let e=m();r(),P("ngModel",e.newComment),p("disabled",e.sending||e.claimStatus!=="pending"),r(3),E("pointer-events-none",e.claimStatus!=="pending"),r(),p("disabled",e.claimStatus!=="pending"),r(3),u(8,e.newComment||e.selectedFile?8:-1)}}var Ve=(()=>{class t{constructor(){this.route=C(L),this.claimsService=C(G),this.messageService=C(k),this.spinnerService=C(z),this.comments=[],this.newComment="",this.selectedFile=null,this.loading=!0,this.sending=!1,this.currentUserId=1,this.currentUserRole="user",this.currentUserName="user name",this.claimId=0,this.IMAGE_BASE_URL=N,this.claimStatus=""}ngOnInit(){this.claimId=+this.route.snapshot.paramMap.get("id");let e=JSON.parse(localStorage.getItem("user"));this.currentUserId=e.id||1,this.currentUserRole=e.role||"user",this.currentUserName=e.name||"user name",this.loadData(),this.startPolling()}loadData(){this.loading=!0,this.route.data.subscribe({next:e=>{this.comments=e.data.comments,this.claimData=e.data.claim,console.log(this.claimData),this.claimStatus=this.claimData.data.status||"pending",this.loading=!1,this.scrollToBottom(),this.spinnerService.hide("actionsLoader")},error:()=>{this.messageService.add({severity:"error",summary:"Error",detail:"Failed to load comments"}),this.loading=!1,this.spinnerService.hide("actionsLoader")}})}onFileSelected(e){let n=e.target.files[0];if(n){if(n.size>10*1024*1024){this.messageService.add({severity:"error",summary:"Error",detail:"File size must be less than 10MB"});return}this.selectedFile=n}}removeFile(){this.selectedFile=null}formatFileSize(e){if(e===0)return"0 Bytes";let n=1024,o=["Bytes","KB","MB","GB"],l=Math.floor(Math.log(e)/Math.log(n));return parseFloat((e/Math.pow(n,l)).toFixed(2))+" "+o[l]}autoResize(e){let n=e.target;n.style.height="auto",n.style.height=Math.min(n.scrollHeight,128)+"px"}onEnterPress(e){e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),this.sendComment())}getFilePreview(e){return e.type.startsWith("image/")?URL.createObjectURL(e):""}ngOnDestroy(){this.stopPolling(),this.selectedFile&&this.selectedFile.type.startsWith("image/")&&URL.revokeObjectURL(this.getFilePreview(this.selectedFile))}sendComment(){if(!this.newComment.trim()&&!this.selectedFile){this.messageService.add({severity:"warn",summary:"Warning",detail:"Please enter a message or select a file"});return}this.sending=!0;let e={user_id:this.currentUserId,user_role:this.currentUserRole,user_name:this.currentUserName,comment:this.newComment||"File attachment",reciver_id:Number(this.claimData.data.user_id)||1,reciver_role:this.claimData.data.user?.role||"user",reciver_name:this.claimData.data.name||"receiver name",claim_id:this.claimData.data.id,claim_number:this.claimData.data.claim_number,claim_status:this.claimData.data.status};this.claimsService.createComment(this.claimId,e,this.selectedFile||null).subscribe({next:n=>{this.comments.push(n.data),this.newComment="",this.selectedFile=null,this.resetTextarea(),this.messageService.add({severity:"success",summary:"Success",detail:"Comment sent successfully"}),this.sending=!1,this.scrollToBottom()},error:n=>{this.messageService.add({severity:"error",summary:"Error",detail:n.error?.message||"Failed to send comment"}),this.sending=!1}})}resetTextarea(){setTimeout(()=>{let e=document.querySelector("textarea");e&&(e.style.height="auto",e.style.height="44px")},0)}formatDate(e){let n=new Date(e),l=(new Date().getTime()-n.getTime())/(1e3*60*60);return l<24?n.toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:!0}):l<48?"Yesterday "+n.toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:!0}):n.toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"numeric",hour12:!0})}scrollToBottom(){setTimeout(()=>{let e=document.querySelector(".chat-messages");e&&(e.scrollTop=e.scrollHeight)},100)}getStatusStyles(e){switch(e.toLowerCase()){case"requested":return"bg-blue-100 text-blue-800 px-2.5 py-0.5 rounded font-medium";case"pending":return"bg-yellow-100 text-yellow-800 px-2.5 py-0.5 rounded font-medium";case"confirmed":return"bg-green-100 text-green-800 px-2.5 py-0.5 rounded font-medium";case"approved":return"bg-green-100 text-green-800 px-2.5 py-0.5 rounded font-medium";case"rejected":case"canceled":return"bg-red-100 text-red-800 px-2.5 py-0.5 rounded font-medium";default:return"bg-gray-100 text-gray-800 px-2.5 py-0.5 rounded font-medium"}}startPolling(){this.pollingInterval=setInterval(()=>{this.claimsService.getClaimComments(this.claimId).subscribe({next:e=>{this.comments=e.data,this.scrollToBottom()},error:e=>{console.error("Error fetching comments:",e)}})},3e4)}stopPolling(){this.pollingInterval&&clearInterval(this.pollingInterval)}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=F({type:t,selectors:[["app-all-jop-claims-comments"]],standalone:!0,features:[D([k]),V],decls:17,vars:8,consts:[[1,"flex","flex-col","h-full","overflow-y-hidden","bg-[#e5ddd5]","bg-opacity-30","bg-[url('https://web.whatsapp.com/img/bg-chat-tile-light_a4be512e7195b6b733d9110b408f075d.png')]"],[1,"flex","h-[40px]","justify-between","items-center","p-3","bg-[#f0f2f5]","border-b","border-gray-300"],[1,"flex","text-2xl","font-semibold","text-gray-800","justify-evenly","items-center","gap-2"],[3,"ngClass"],[1,"text-[#008069]","hover:underline","font-medium","text-lg",3,"routerLink"],[1,"p-3","bg-white","border-t","border-gray-200"],[1,"p-3","bg-[#f0f2f5]","border-t","border-gray-300","max-h-[70px]"],[3,"ngSubmit"],[1,"text-sm","text-red-600","mt-2","text-center"],[1,"flex-1","overflow-y-auto","p-4","space-y-3","bg-[#e5ddd5]","bg-opacity-30","chat-messages"],[1,"flex",3,"ngClass"],[1,"min-w-[200px]","max-w-[65%]","p-3","rounded-lg","shadow-sm","relative",3,"ngClass"],[1,"flex","justify-between","items-center","mb-2"],[1,"font-semibold","text-base","text-[#111b21]"],[1,"text-sm","text-gray-500","ml-2"],[1,"text-base","text-[#111b21]","break-words","leading-relaxed","mb-2",2,"white-space","pre-wrap"],[1,"mt-2","py-2","bg-gray-50","rounded","border"],[1,"text-sm","text-gray-500","mt-2","border-t","pt-1"],["target","_blank",1,"text-[#008069]","text-base","hover:underline","flex","items-center",3,"href"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"],[1,"flex","items-center","justify-between","bg-gray-50","p-2","rounded-lg","border"],[1,"flex","items-center","gap-3"],["alt","Preview",1,"w-12","h-12","object-cover","rounded",3,"src"],[1,"flex","flex-col"],[1,"text-base","font-medium","text-gray-700","truncate","max-w-[200px]"],[1,"text-sm","text-gray-500"],["type","button",1,"p-1","text-gray-500","hover:text-red-500","rounded-full","hover:bg-gray-100",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"w-12","h-12","flex","items-center","justify-center","bg-gray-200","rounded"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-8","h-8","text-gray-500"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"],[1,"flex","items-center","gap-1","w-full","bg-white","rounded-full","pl-4","pr-1","py-2"],["name","comment","placeholder","Type a message...","rows","1",1,"flex-1","py-1","bg-transparent","border-none","focus:outline-none","text-base","resize-none","max-h-32","overflow-y-auto","placeholder-gray-500",3,"ngModelChange","input","keydown.enter","ngModel","disabled"],[1,"flex","items-center","gap-1"],[1,"cursor-pointer","p-2","text-gray-500","hover:text-gray-700","rounded-full","transition-colors","flex","items-center","justify-center"],["type","file","accept","*/*",1,"hidden",3,"change","disabled"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-8","h-8"],["type","submit",1,"p-2","bg-[#008069]","text-white","rounded-full","hover:bg-[#017561]","disabled:bg-gray-400","transition-colors","flex","items-center","justify-center",3,"disabled"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"animate-spin","w-8","h-8"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"w-8","h-8"],["x1","22","y1","2","x2","11","y2","13"],["points","22 2 15 22 11 13 2 9 22 2"]],template:function(n,o){n&1&&(i(0,"div",0),d(1,"p-toast"),i(2,"div",1)(3,"h2",2),c(4),i(5,"span",3),c(6),a()(),i(7,"a",4),c(8,"Back to Claims"),a()(),h(9,ae,1,0,"app-loading-data-banner")(10,se,2,0)(11,ce,3,0)(12,ue,13,3,"div",5),i(13,"div",6)(14,"form",7),x("ngSubmit",function(){return o.sendComment()}),h(15,ge,2,0,"p",8)(16,Ce,9,6),a()()()),n&2&&(r(4),v(" Claimant: ",o.claimData.data.name||"CLAIMANT NAME"," - Claim Status: "),r(),p("ngClass",o.getStatusStyles(o.claimStatus)),r(),v(" (",o.claimStatus,") "),r(),p("routerLink",B(7,ie)),r(2),u(9,o.loading?9:o.comments.length===0?10:11),r(3),u(12,o.selectedFile?12:-1),r(3),u(15,o.claimStatus!=="pending"?15:16))},dependencies:[O,J,Q,$,W,H,Y,K,q,j,Z,X,R,ee,te],styles:[".chat-messages[_ngcontent-%COMP%]{scrollbar-width:thin;scrollbar-color:#ccc transparent}.chat-messages[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.chat-messages[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.chat-messages[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:#ccc;border-radius:3px}.chat-messages[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background-color:#bbb}.message-bubble[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeInUp .3s ease-out}@keyframes _ngcontent-%COMP%_fadeInUp{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.file-preview[_ngcontent-%COMP%]{transition:transform .2s ease}.file-preview[_ngcontent-%COMP%]:hover{transform:scale(1.02)}.status-badge[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500;padding:.25rem .625rem;border-radius:.375rem;display:inline-flex;align-items:center}@media (max-width: 768px){.chat-messages[_ngcontent-%COMP%]{padding:.75rem}.message-bubble[_ngcontent-%COMP%]{max-width:85%;min-width:150px}.header-title[_ngcontent-%COMP%]{font-size:1.25rem}}.loading-spinner[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}"]})}}return t})();export{Ve as AllJopClaimsCommentsComponent};
