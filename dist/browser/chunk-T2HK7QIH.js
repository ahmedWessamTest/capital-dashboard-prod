import{a as Z}from"./chunk-NH6Q3UB7.js";import{a as G,b as H,c as K,d as W}from"./chunk-2CYVADF6.js";import"./chunk-ULFGH5XU.js";import{a as Y}from"./chunk-Y6SZKX5H.js";import"./chunk-4WY6IZPL.js";import{e as z}from"./chunk-WDDFHKIH.js";import"./chunk-AGVKSH7H.js";import{p as k,q as O}from"./chunk-V2NMUT4R.js";import{a as X}from"./chunk-2O7EOZOI.js";import{a as V}from"./chunk-KEBJO4LJ.js";import{d as J,e as U}from"./chunk-PEYIU4ER.js";import"./chunk-RJZ3H7D5.js";import"./chunk-5YI4S6VK.js";import{d as A,f as $}from"./chunk-PXM2JOVS.js";import{C as Q}from"./chunk-27E65EIB.js";import{d as F}from"./chunk-67M3DXMG.js";import{m as q,n as B}from"./chunk-FYJ5Y7AH.js";import{$a as h,Ab as u,Gb as D,Hb as M,Ib as j,Kb as s,Lb as c,Qa as d,Sb as I,Y as f,ac as L,ba as w,cc as R,fb as y,hb as T,ka as g,la as _,mb as P,qb as r,rb as a,sb as m,wb as C,zb as b}from"./chunk-PSXZOWGB.js";import{a as N,b as E}from"./chunk-PSFXZ2QL.js";var ee=["dt"];function te(o,p){o&1&&m(0,"app-loading-data-banner")}function ie(o,p){o&1&&(r(0,"tr")(1,"th",8),s(2," User Id "),m(3,"p-sortIcon",9),a(),r(4,"th",10),s(5," Name "),m(6,"p-sortIcon",11),a(),r(7,"th",12),s(8," Policy Id "),m(9,"p-sortIcon",13),a(),r(10,"th",14),s(11," Category"),m(12,"p-sortIcon",15),a(),r(13,"th",16),s(14," Expiry Date "),m(15,"p-sortIcon",17),a(),r(16,"th",18),s(17,"Actions"),a()())}function oe(o,p){if(o&1){let e=C();r(0,"tr")(1,"td",18),s(2),a(),r(3,"td",18),s(4),a(),r(5,"td",18),s(6),a(),r(7,"td",18),s(8),a(),r(9,"td",18),s(10),L(11,"date"),a(),r(12,"td",18)(13,"div",19)(14,"button",20),b("click",function(){let n=g(e).$implicit,i=u(2);return _(i.viewExpiryNotification(n.category_id,n.id))}),a()()()()}if(o&2){let e=p.$implicit,t=u(2);d(2),c(e.user_id),d(2),c(e.name),d(2),c(e.id),d(2),c(t.getCategoryLabel(e.category)),d(2),c(R(11,5,e.end_date,"dd-MM-yyyy"))}}function ne(o,p){o&1&&(r(0,"tr")(1,"td",21)(2,"div")(3,"div",22),m(4,"app-no-data-found-banner"),a()()()())}function re(o,p){if(o&1){let e=C();r(0,"div",1)(1,"div",2)(2,"h2",3),s(3,"Expiry Notifications"),a()(),r(4,"p-table",4,0),b("sortFunction",function(n){g(e);let i=u();return _(i.customSort(n))}),y(6,ie,18,0,"ng-template",5)(7,oe,15,8,"ng-template",6)(8,ne,5,0,"ng-template",7),a()()}if(o&2){let e=u();d(4),T("paginator",!0)("rows",e.rowsPerPage)("totalRecords",e.totalRecords)("rowsPerPageOptions",e.getPagination())("showCurrentPageReport",!0)("value",e.expiryNotifications())("customSort",!0)}}var we=(()=>{class o{constructor(){this.expiryNotifications=h([]),this.isLoading=h(!1),this.ngxSpinnerService=f(V),this.router=f(F),this.sendNotificationService=f(Z),this.selectedCategory=null,this.selectedNeedCall=null,this.selectedLeadType=null,this.totalRecords=0,this.rowsPerPage=10}ngOnInit(){this.fetchData()}getCategoryName(e){switch(e){case 1:return"medical";case 2:return"motor";case 3:return"building";case 5:return"job";default:return""}}fetchData(){this.ngxSpinnerService.show("actionsLoader"),this.isLoading.set(!0),this.sendNotificationService.getExpireNotifications().subscribe({next:e=>{this.expiryNotifications.set([...e.Buildingjobs??[],...e.Jopjobs??[],...e.Medicaljobs??[],...e.Motorjobs??[]].map(t=>E(N({},t),{end_date:this.parseDate(t.end_date),category:this.getCategoryName(t.category_id)}))),this.totalRecords=this.expiryNotifications.length,console.log(this.expiryNotifications()),this.isLoading.set(!1)}})}parseDate(e){if(!e)return null;let[t,n,i]=e.split("-").map(Number);return new Date(i,n-1,t)}customSort(e){let{field:t,order:n}=e;console.log(n),console.log(t),t==="end_date"?e.data.sort((i,l)=>{let S=i.end_date?.getTime?.()??0,v=l.end_date?.getTime?.()??0,x=0;return S<v?x=-1:S>v&&(x=1),e.order*x}):t==="name"?e.data.sort((i,l)=>i.name.localeCompare(l.name)*n):t==="category"?e.data.sort((i,l)=>i.category.localeCompare(l.category)*n):t==="user_id"?e.data.sort((i,l)=>(i.user_id-l.user_id)*n):t==="id"&&e.data.sort((i,l)=>(i.id-l.id)*n)}getPagination(){let e=this.expiryNotifications.length;return[10,25,50,100,e].filter(t=>t<=e)}viewExpiryNotification(e,t){e===1?this.router.navigate(["/dashboard/menu/medical-requests/view-medical-request",t]):e===2?this.router.navigate(["/dashboard/menu/motor-requests/view-motor-request",t]):e===3?this.router.navigate(["/dashboard/menu/building-requests/view-building-request",t]):e===5&&this.router.navigate(["/dashboard/menu/jop-requests/view",t])}getCategoryLabel(e){return{job:"professional",building:"property"}[e]||e}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275cmp=w({type:o,selectors:[["app-expire-notification"]],viewQuery:function(t,n){if(t&1&&D(ee,5),t&2){let i;M(i=j())&&(n.dt=i.first)}},standalone:!0,features:[I],decls:3,vars:1,consts:[["dt",""],[1,"card"],[1,"flex","justify-between","items-center","mb-3"],[1,"text-2xl","font-semibold"],["responsiveLayout","scroll",3,"sortFunction","paginator","rows","totalRecords","rowsPerPageOptions","showCurrentPageReport","value","customSort"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["pSortableColumn","user_id",1,"text-center"],["field","user_id"],["pSortableColumn","name",1,"text-center"],["field","name"],["pSortableColumn","id",1,"text-center"],["field","id"],["pSortableColumn","category",1,"text-center"],["field","category"],["pSortableColumn","end_date",1,"text-center"],["field","end_date"],[1,"text-center"],[1,"flex","justify-center","items-center"],["pButton","","icon","pi pi-search",3,"click"],["colspan","6"],[1,"h-48","flex","justify-center","items-center","flex-col"]],template:function(t,n){t&1&&(y(0,te,1,0,"app-loading-data-banner")(1,re,9,7),m(2,"p-toast")),t&2&&P(0,n.isLoading()?0:1)},dependencies:[$,A,Q,O,W,G,H,K,k,z,U,J,B,q,X,Y]})}}return o})();export{we as ExpireNotificationComponent};
