import{a as r}from"./chunk-RJZ3H7D5.js";import{o as p,r as d}from"./chunk-FYJ5Y7AH.js";import{$a as m,L as h,S as g,Y as c,v as f,wa as u}from"./chunk-PSXZOWGB.js";import{a as i,b as s}from"./chunk-PSFXZ2QL.js";function N(a){let l=new FormData;return Object.keys(a).forEach(t=>{let o=a[t];o!=null&&l.append(t,o.toString())}),l}var T=(()=>{class a{constructor(){this.http=c(d),this.hasNewNotify=m(!1),this._PLATFORM_ID=c(u),this.adminNotifications=m([]),this.startPolling()}sendNotification(t){let o=N(t);return this.http.post(`${r}sendAllUsersNotification`,o)}getExpireNotifications(){return this.http.get(`${r}getExpirePolicy`)}getAdminNotifications(){return this.http.get(`${r}admincommecnts`)}startPolling(){f(5e3).pipe(h(()=>this.http.get(`${r}admincommecnts`))).subscribe({next:t=>{let n=[...t.BuildingClaimComment??[],...t.JopClaimComment??[],...t.MotorClaimComment??[],...t.MedicalClaimComment??[],...t.BuildingComment??[],...t.JopComment??[],...t.MedicalComment??[],...t.MotorComment??[]].map(e=>e.request&&typeof e.request=="object"?s(i(i({},e),e.request),{req_id:e.request.id,req_type:"policy",comment_date:this.parseDateTime(e.comment_date),category_name:this.getCategoryName(e?.request.category_id)}):e.claim&&typeof e.claim=="object"?s(i(i({},e),e.claim),{req_id:e.claim.id,req_type:"claim",comment_date:this.parseDateTime(e.comment_date),category_name:this.getCategoryName(e?.claim.category_id)}):s(i({},e),{comment_date:this.parseDateTime(e.comment_date),category_name:this.getCategoryName(e?.category_id)}));this.handleNewNotifications(n)}})}parseDateTime(t){return t?new Date(t):null}getCategoryName(t){switch(t){case 1:return"medical";case 2:return"motor";case 3:return"building";case 5:return"job";default:return""}}handleNewNotifications(t){if(!p(this._PLATFORM_ID))return;let o="lastNotificationLength",n="seenNotification",e=t.length,_=Number(localStorage.getItem(o)??0);if(e>_)this.hasNewNotify.set(!0),localStorage.setItem(n,"false");else{let y=localStorage.getItem(n)==="true";this.hasNewNotify.set(!y)}localStorage.setItem(o,String(e)),this.adminNotifications.set(t)}markAllAsSeen(){this.hasNewNotify.set(!1),localStorage.setItem("seenNotification","true")}clearNewFlag(){this.hasNewNotify.set(!1)}static{this.\u0275fac=function(o){return new(o||a)}}static{this.\u0275prov=g({token:a,factory:a.\u0275fac,providedIn:"root"})}}return a})();export{T as a};
