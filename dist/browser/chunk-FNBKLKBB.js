import{a as P}from"./chunk-V2A3WW6V.js";import{a as A}from"./chunk-DCM55A5P.js";import{a as ee}from"./chunk-OOHQEE5L.js";import{d as X,e as Z}from"./chunk-WDDFHKIH.js";import{a as Q,b as U}from"./chunk-NZNLV7ZF.js";import{a as J,b as K}from"./chunk-AGVKSH7H.js";import{b as j,c as h,e as q,f as G,g as V,k as z,m as R,n as B,o as $,q as W}from"./chunk-V2NMUT4R.js";import{a as L}from"./chunk-KEBJO4LJ.js";import"./chunk-RJZ3H7D5.js";import"./chunk-5YI4S6VK.js";import{f as H}from"./chunk-PXM2JOVS.js";import"./chunk-27E65EIB.js";import{b as O,d as D}from"./chunk-67M3DXMG.js";import{h as T,j as k,n as N}from"./chunk-FYJ5Y7AH.js";import{Ab as w,Kb as c,Lb as x,Mb as b,Qa as d,Ra as u,Sb as M,Tb as I,Ub as S,Wb as E,ba as C,fb as f,hb as g,kb as F,mb as v,qb as i,rb as n,sb as _,zb as y}from"./chunk-PSXZOWGB.js";import"./chunk-PSFXZ2QL.js";var re=()=>({width:"100%"}),te=a=>({"ng-invalid ng-dirty":a}),ae=(a,p,e)=>({"bg-green-100 border-green-400 text-green-700":a,"bg-red-100 border-red-400 text-red-700":p,"bg-yellow-100 border-yellow-400 text-yellow-700":e});function ie(a,p){if(a&1&&(i(0,"div",3)(1,"strong",22),c(2),n(),i(3,"span",23),c(4),n()()),a&2){let e=w();g("ngClass",E(3,ae,e.message.type==="success",e.message.type==="error",e.message.type==="warn")),d(2),x(e.message.type==="success"?"Success!":e.message.type==="error"?"Error!":"Warning!"),d(2),x(e.message.text)}}function ne(a,p){a&1&&(i(0,"small",14),c(1,"Car Model is required"),n())}function oe(a,p){a&1&&(i(0,"small",14),c(1,"Year is required"),n())}function le(a,p){a&1&&(i(0,"small",14),c(1,"Please enter a valid 4-digit year"),n())}function se(a,p){a&1&&(i(0,"small",14),c(1,"Please enter a valid year (e.g., between 1900 and current year + 1)"),n())}function de(){return a=>{if(!a.value)return null;let p=parseInt(a.value,10),e=new Date().getFullYear();return isNaN(p)||p<1900||p>e+1?{yearRange:{value:a.value}}:null}}var Me=(()=>{class a{constructor(e,o,t,l,s,m,r){this.fb=e,this.route=o,this.router=t,this.ngxSpinnerService=l,this.carYearsService=s,this.validationService=m,this.normalizeActiveStatus=r,this.carModels=[],this.dataSubscription=null,this.loading=!1,this.message={text:"",type:""},this.carYearId=null,this.carYearForm=this.fb.group({car_model_id:["",h.required],year_date:["",[h.required,h.pattern(/^\d{4}$/),de()]],active_status:[!0,h.required]})}numericOnly(e){return this.validationService.numericOnly(e)}preventInvalidPaste(e){this.validationService.preventInvalidPaste(e)}ngOnInit(){this.dataSubscription=this.route.data.subscribe({next:e=>{console.log(e),e?.data?.carYear&&e?.data?.carModels?(this.carModels=e.data.carModels||[],this.carYearId=e.data.carYear.id,this.carYearForm.patchValue({car_model_id:e.data.carYear.car_model_id,year_date:e.data.carYear.year_date,active_status:this.normalizeActiveStatus.normalizeActiveStatus(e.data.carYear.active_status)}),this.ngxSpinnerService.hide("actionsLoader")):(this.message={text:"Failed to load car year or models data",type:"error"},this.clearMessage(),this.ngxSpinnerService.hide("actionsLoader"))},error:e=>{console.error("Failed to load car year data:",e),this.message={text:"Failed to load required data",type:"error"},this.clearMessage(),this.ngxSpinnerService.hide("actionsLoader")}})}onSubmit(){if(this.carYearForm.invalid){this.markFormGroupTouched(this.carYearForm);return}if(!this.carYearId){this.message={text:"No car year ID provided",type:"error"},this.clearMessage();return}this.loading=!0,this.message={text:"",type:""};let e=this.carYearForm.value,o=e.car_model_id,t=e.year_date;this.carYearsService.getAll().subscribe({next:l=>{if(l.data.filter(r=>r.car_model_id===o&&r.id!==this.carYearId).map(r=>r.year_date).includes(t)){this.message={text:`The year ${t} already exists for the selected car model.`,type:"warn"},this.clearMessage(),this.ngxSpinnerService.hide("actionsLoader"),this.loading=!1;return}this.ngxSpinnerService.show("actionsLoader");let m=new FormData;m.append("car_model_id",o),m.append("year_date",t),m.append("active_status",e.active_status?"1":"0"),this.carYearId&&this.carYearsService.update(this.carYearId,m).subscribe({next:()=>{this.message={text:"Car year updated successfully",type:"success"},this.router.navigate(["/dashboard/menu/car-years"]),this.ngxSpinnerService.hide("actionsLoader"),this.loading=!1,this.clearMessage()},error:r=>{console.error("Error updating car year:",r),this.message={text:"Failed to update car year",type:"error"},this.clearMessage(),this.ngxSpinnerService.hide("actionsLoader"),this.loading=!1}})},error:l=>{console.error("Error fetching existing car years:",l),this.message={text:"Failed to check for existing car years.",type:"error"},this.clearMessage(),this.ngxSpinnerService.hide("actionsLoader"),this.loading=!1}})}markFormGroupTouched(e){Object.values(e.controls).forEach(o=>{o.markAsTouched(),o instanceof V&&this.markFormGroupTouched(o)})}clearMessage(){setTimeout(()=>{this.message={text:"",type:""}},5e3)}ngOnDestroy(){this.dataSubscription&&this.dataSubscription.unsubscribe(),this.ngxSpinnerService.hide("actionsLoader")}static{this.\u0275fac=function(o){return new(o||a)(u($),u(O),u(D),u(L),u(P),u(ee),u(A))}}static{this.\u0275cmp=C({type:a,selectors:[["app-edit-car-years"]],standalone:!0,features:[M],decls:32,vars:18,consts:[[1,"py-8"],[1,"w-full","mb-4"],[1,"text-xl","font-semibold"],["role","alert",1,"border","px-4","py-3","rounded","relative","mb-4",3,"ngClass"],[1,"w-full",3,"ngSubmit","formGroup"],[1,"flex","flex-col","sm:flex-row","gap-4","mb-6"],[1,"flex-1","w-full"],["for","car_model_id",1,"flex","items-center","gap-1","mx-2","mb-2","font-semibold"],[1,"w-full"],["id","car_model_id","formControlName","car_model_id","optionLabel","en_title","optionValue","id","placeholder","Select Car Model",1,"w-full",3,"options","showClear","ngClass"],[1,"h-6","mt-2"],["class","text-red-500 text-sm mx-4 block",4,"ngIf"],["for","year_date",1,"flex","items-center","gap-1","mx-2","mb-2","font-semibold"],["id","year_date","type","text","pInputText","","formControlName","year_date","placeholder","Enter year (e.g. 2023)",1,"w-full","border","rounded","form-input",3,"keypress","paste","ngClass"],[1,"text-red-500","text-sm","mx-4","block"],[1,"flex","gap-2","mx-4","items-center"],[1,""],[1,"flex","gap-2","items-center"],["id","active_status","formControlName","active_status"],["for","active_status",1,"text-lg"],[1,"flex-1"],["type","submit",1,"px-4","py-2","bg-blue-500","text-white","rounded","text-xl","hover:bg-blue-600","disabled:opacity-50","disabled:cursor-not-allowed",3,"disabled"],[1,"font-bold"],[1,"block","sm:inline","ml-2"]],template:function(o,t){if(o&1&&(i(0,"div",0)(1,"div",1)(2,"h2",2),c(3,"Edit Car Year"),n()(),f(4,ie,5,7,"div",3),i(5,"form",4),y("ngSubmit",function(){return t.onSubmit()}),i(6,"div",5)(7,"div",6)(8,"label",7),c(9,"Car Model"),n(),i(10,"div",8),_(11,"p-dropdown",9),i(12,"div",10),f(13,ne,2,0,"small",11),n()()(),i(14,"div",6)(15,"label",12),c(16,"Year"),n(),i(17,"div",8)(18,"input",13),y("keypress",function(s){return t.numericOnly(s)})("paste",function(s){return t.preventInvalidPaste(s)}),n(),i(19,"div",10),f(20,oe,2,0,"small",14)(21,le,2,0)(22,se,2,0),n()()()(),i(23,"div",15)(24,"div",16)(25,"div",17),_(26,"p-inputSwitch",18),i(27,"label",19),c(28),n()()(),_(29,"div",20),i(30,"button",21),c(31),n()()()()),o&2){let l,s,m,r,Y;d(4),v(4,t.message.text?4:-1),d(),g("formGroup",t.carYearForm),d(6),F(I(13,re)),g("options",t.carModels)("showClear",!1)("ngClass",S(14,te,((l=t.carYearForm.get("car_model_id"))==null?null:l.invalid)&&((l=t.carYearForm.get("car_model_id"))==null?null:l.touched))),d(2),g("ngIf",((s=t.carYearForm.get("car_model_id"))==null?null:s.touched)&&((s=t.carYearForm.get("car_model_id"))==null||s.errors==null?null:s.errors.required)),d(5),g("ngClass",S(16,te,((m=t.carYearForm.get("year_date"))==null?null:m.invalid)&&((m=t.carYearForm.get("year_date"))==null?null:m.touched))),d(2),v(20,(r=t.carYearForm.get("year_date"))!=null&&r.touched&&(!((r=t.carYearForm.get("year_date"))==null||r.errors==null)&&r.errors.required)?20:(r=t.carYearForm.get("year_date"))!=null&&r.touched&&(!((r=t.carYearForm.get("year_date"))==null||r.errors==null)&&r.errors.pattern)?21:(r=t.carYearForm.get("year_date"))!=null&&r.touched&&(!((r=t.carYearForm.get("year_date"))==null||r.errors==null)&&r.errors.yearRange)?22:-1),d(8),b(" ",(Y=t.carYearForm.get("active_status"))!=null&&Y.value?"Active":"Inactive"," "),d(2),g("disabled",t.loading||!t.carYearForm.valid),d(),b(" ",t.loading?"Loading...":"Submit"," ")}},dependencies:[N,T,k,W,z,j,q,G,R,B,Z,X,K,J,U,Q,H],styles:["[_nghost-%COMP%]     .p-dropdown{width:100%;height:50px;background:#fff;border-radius:12px;padding:0 20px;color:#1f2937;transition:all .2s ease;border:1px solid rgba(0,0,0,.285)}[_nghost-%COMP%]     .p-dropdown .p-dropdown-label{font-size:16px;color:#6b7280;margin-top:1px}[_nghost-%COMP%]     .p-calendar{width:100%}[_nghost-%COMP%]     .p-calendar .p-inputtext{width:100%;height:50px;background:#fff;border-radius:12px;padding:0 20px;color:#1f2937;transition:all .2s ease;border:1px solid rgba(0,0,0,.285);font-size:16px}[_nghost-%COMP%]     .p-calendar .p-inputtext::placeholder{color:#6b7280}[_nghost-%COMP%]     .p-calendar .p-datepicker-trigger{background:transparent;border:none;position:absolute;right:10px;top:50%;transform:translateY(-50%);color:#6b7280}"]})}}return a})();export{Me as EditYearComponent};
