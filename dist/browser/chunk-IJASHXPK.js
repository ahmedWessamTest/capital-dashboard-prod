import{a as P}from"./chunk-V2A3WW6V.js";import{a as Z}from"./chunk-OOHQEE5L.js";import{d as U,e as X}from"./chunk-WDDFHKIH.js";import{a as K,b as Q}from"./chunk-NZNLV7ZF.js";import{a as H,b as J}from"./chunk-AGVKSH7H.js";import{b as D,c as f,e as q,f as G,g as j,k as V,m as R,n as z,o as B,q as $}from"./chunk-V2NMUT4R.js";import{a as L}from"./chunk-KEBJO4LJ.js";import"./chunk-RJZ3H7D5.js";import"./chunk-5YI4S6VK.js";import{f as W}from"./chunk-PXM2JOVS.js";import"./chunk-27E65EIB.js";import{b as N,d as O}from"./chunk-67M3DXMG.js";import{h as T,j as A,n as k}from"./chunk-FYJ5Y7AH.js";import{Ab as w,Kb as c,Lb as y,Mb as b,Qa as d,Ra as u,Sb as M,Tb as I,Ub as S,Wb as E,ba as Y,fb as h,hb as g,kb as F,mb as _,qb as i,rb as n,sb as v,zb as x}from"./chunk-PSXZOWGB.js";import"./chunk-PSFXZ2QL.js";var ee=()=>({width:"100%"}),te=r=>({"ng-invalid ng-dirty":r}),re=r=>({"  ng-invalid ng-dirty":r}),ae=(r,p,e)=>({"bg-green-100 border-green-400 text-green-700":r,"bg-red-100 border-red-400 text-red-700":p,"bg-yellow-100 border-yellow-400 text-yellow-700":e});function ie(r,p){if(r&1&&(i(0,"div",3)(1,"strong",22),c(2),n(),i(3,"span",23),c(4),n()()),r&2){let e=w();g("ngClass",E(3,ae,e.message.type==="success",e.message.type==="error",e.message.type==="warn")),d(2),y(e.message.type==="success"?"Success!":e.message.type==="error"?"Error!":"Warning!"),d(2),y(e.message.text)}}function ne(r,p){r&1&&(i(0,"small",14),c(1,"Car Model is required"),n())}function oe(r,p){r&1&&(i(0,"small",14),c(1,"Year is required"),n())}function le(r,p){r&1&&(i(0,"small",14),c(1,"Please enter a valid 4-digit year"),n())}function se(r,p){r&1&&(i(0,"small",14),c(1,"Please enter a valid year (e.g., between 1900 and current year + 1)"),n())}function de(){return r=>{if(!r.value)return null;let p=parseInt(r.value,10),e=new Date().getFullYear();return isNaN(p)||p<1900||p>e+1?{yearRange:{value:r.value}}:null}}var we=(()=>{class r{constructor(e,o,t,l,s,m){this.fb=e,this.route=o,this.router=t,this.ngxSpinnerService=l,this.carYearsService=s,this.validationService=m,this.carModels=[],this.dataSubscription=null,this.loading=!1,this.message={text:"",type:""},this.carYearForm=this.fb.group({car_model_id:["",f.required],year_date:["",[f.required,f.pattern(/^\d{4}$/),de()]],active_status:[!0,f.required]})}ngOnInit(){this.dataSubscription=this.route.data.subscribe({next:e=>{e?.data?.carModels?(this.carModels=e.data.carModels||[],this.ngxSpinnerService.hide("actionsLoader")):(this.message={text:"No car models data received from resolver",type:"error"},this.clearMessage(),this.ngxSpinnerService.hide("actionsLoader"))},error:e=>{console.error("Failed to load car models data:",e),this.message={text:"Failed to load required car models data",type:"error"},this.clearMessage(),this.ngxSpinnerService.hide("actionsLoader")}})}onSubmit(){if(this.carYearForm.invalid){this.markFormGroupTouched(this.carYearForm);return}this.loading=!0,this.message={text:"",type:""};let e=this.carYearForm.value,o=e.car_model_id,t=e.year_date;this.carYearsService.getAll().subscribe({next:l=>{if(l.data.filter(a=>a.car_model_id===o).map(a=>a.year_date).includes(t)){this.message={text:`The year ${t} already exists for the selected car model.`,type:"warn"},this.clearMessage(),this.ngxSpinnerService.hide("actionsLoader"),this.loading=!1;return}this.ngxSpinnerService.show("actionsLoader");let m=new FormData;m.append("car_model_id",o),m.append("year_date[]",t),m.append("active_status",e.active_status?"1":"0"),this.carYearsService.create(m).subscribe({next:()=>{this.message={text:"Car year created successfully",type:"success"},this.router.navigate(["/dashboard/menu/car-years"]),this.ngxSpinnerService.hide("actionsLoader"),this.loading=!1,this.clearMessage()},error:a=>{console.error("Error creating car year:",a),this.message={text:"Failed to create car year",type:"error"},this.clearMessage(),this.ngxSpinnerService.hide("actionsLoader"),this.loading=!1}})},error:l=>{console.error("Error fetching existing car years:",l),this.message={text:"Failed to check for existing car years.",type:"error"},this.clearMessage(),this.ngxSpinnerService.hide("actionsLoader"),this.loading=!1}})}markFormGroupTouched(e){Object.values(e.controls).forEach(o=>{o.markAsTouched(),o instanceof j&&this.markFormGroupTouched(o)})}clearMessage(){setTimeout(()=>{this.message={text:"",type:""}},5e3)}numericOnly(e){return this.validationService.numericOnly(e)}preventInvalidPaste(e){this.validationService.preventInvalidPaste(e)}ngOnDestroy(){this.dataSubscription&&this.dataSubscription.unsubscribe(),this.ngxSpinnerService.hide("actionsLoader")}static{this.\u0275fac=function(o){return new(o||r)(u(B),u(N),u(O),u(L),u(P),u(Z))}}static{this.\u0275cmp=Y({type:r,selectors:[["app-add-car-years"]],standalone:!0,features:[M],decls:32,vars:18,consts:[[1,"py-8"],[1,"w-full","mb-4"],[1,"text-xl","font-semibold"],["role","alert",1,"border","px-4","py-3","rounded","relative","mb-4",3,"ngClass"],[1,"w-full",3,"ngSubmit","formGroup"],[1,"flex","flex-col","sm:flex-row","gap-4","mb-6"],[1,"flex-1","w-full"],["for","car_model_id",1,"flex","items-center","gap-1","mx-2","mb-2","font-semibold"],[1,"w-full"],["id","car_model_id","formControlName","car_model_id","optionLabel","en_title","optionValue","id","placeholder","Select Car Model",1,"w-full",3,"options","showClear","ngClass"],[1,"h-6","mt-2"],["class","text-red-500 text-sm mx-4 block",4,"ngIf"],["for","year_date",1,"flex","items-center","gap-1","mx-2","mb-2","font-semibold"],["id","year_date","type","text","pInputText","","formControlName","year_date","placeholder","Enter year (e.g. 2023)",1,"w-full","border","rounded","form-input",3,"keypress","paste","ngClass"],[1,"text-red-500","text-sm","mx-4","block"],[1,"flex","gap-2","mx-4","items-center","bg-red-50"],[1,""],[1,"flex","gap-2","items-center"],["id","active_status","formControlName","active_status"],["for","active_status",1,"text-lg"],[1,"flex-1"],["type","submit",1,"px-4","py-2","bg-blue-500","text-white","rounded","text-xl","hover:bg-blue-600","disabled:opacity-50","disabled:cursor-not-allowed",3,"disabled"],[1,"font-bold"],[1,"block","sm:inline","ml-2"]],template:function(o,t){if(o&1&&(i(0,"div",0)(1,"div",1)(2,"h2",2),c(3,"Add Car Year"),n()(),h(4,ie,5,7,"div",3),i(5,"form",4),x("ngSubmit",function(){return t.onSubmit()}),i(6,"div",5)(7,"div",6)(8,"label",7),c(9,"Car Model"),n(),i(10,"div",8),v(11,"p-dropdown",9),i(12,"div",10),h(13,ne,2,0,"small",11),n()()(),i(14,"div",6)(15,"label",12),c(16,"Year"),n(),i(17,"div",8)(18,"input",13),x("keypress",function(s){return t.numericOnly(s)})("paste",function(s){return t.preventInvalidPaste(s)}),n(),i(19,"div",10),h(20,oe,2,0,"small",14)(21,le,2,0)(22,se,2,0),n()()()(),i(23,"div",15)(24,"div",16)(25,"div",17),v(26,"p-inputSwitch",18),i(27,"label",19),c(28),n()()(),v(29,"div",20),i(30,"button",21),c(31),n()()()()),o&2){let l,s,m,a,C;d(4),_(4,t.message.text?4:-1),d(),g("formGroup",t.carYearForm),d(6),F(I(13,ee)),g("options",t.carModels)("showClear",!1)("ngClass",S(14,te,((l=t.carYearForm.get("car_model_id"))==null?null:l.invalid)&&((l=t.carYearForm.get("car_model_id"))==null?null:l.touched))),d(2),g("ngIf",((s=t.carYearForm.get("car_model_id"))==null?null:s.touched)&&((s=t.carYearForm.get("car_model_id"))==null||s.errors==null?null:s.errors.required)),d(5),g("ngClass",S(16,re,((m=t.carYearForm.get("year_date"))==null?null:m.invalid)&&((m=t.carYearForm.get("year_date"))==null?null:m.touched))),d(2),_(20,(a=t.carYearForm.get("year_date"))!=null&&a.touched&&(!((a=t.carYearForm.get("year_date"))==null||a.errors==null)&&a.errors.required)?20:(a=t.carYearForm.get("year_date"))!=null&&a.touched&&(!((a=t.carYearForm.get("year_date"))==null||a.errors==null)&&a.errors.pattern)?21:(a=t.carYearForm.get("year_date"))!=null&&a.touched&&(!((a=t.carYearForm.get("year_date"))==null||a.errors==null)&&a.errors.yearRange)?22:-1),d(8),b(" ",(C=t.carYearForm.get("active_status"))!=null&&C.value?"Active":"Inactive"," "),d(2),g("disabled",t.loading||!t.carYearForm.valid),d(),b(" ",t.loading?"Loading...":"Submit"," ")}},dependencies:[k,T,A,$,V,D,q,G,R,z,X,U,J,H,Q,K,W],styles:["[_nghost-%COMP%]     .p-dropdown{width:100%;height:50px;background:#fff;border-radius:12px;padding:0 20px;color:#1f2937;transition:all .2s ease;border:1px solid rgba(0,0,0,.285)}[_nghost-%COMP%]     .p-dropdown .p-dropdown-label{font-size:16px;color:#6b7280;margin-top:1px}[_nghost-%COMP%]     .p-calendar{width:100%}[_nghost-%COMP%]     .p-calendar .p-inputtext{width:100%;height:50px;background:#fff;border-radius:12px;padding:0 20px;color:#1f2937;transition:all .2s ease;border:1px solid rgba(0,0,0,.285);font-size:16px}[_nghost-%COMP%]     .p-calendar .p-inputtext::placeholder{color:#6b7280}[_nghost-%COMP%]     .p-calendar .p-datepicker-trigger{background:transparent;border:none;position:absolute;right:10px;top:50%;transform:translateY(-50%);color:#6b7280}"]})}}return r})();export{we as AddYearComponent};
